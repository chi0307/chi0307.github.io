import{d as ie,c as p,b as g,o as ve,w as S,C,j as O,k as D,q as c,y as t,D as r,F as q,t as ce,x as P,E as Y,z as G,v as K,u as me,B as fe}from"../index-D1xxbJOR.js";import{f as j,a as Q,l as X,i as Z,b as pe,c as be,v as ye}from"../StorageManager-BZI-2h3z.js";import{r as ge,i as U,a as Ce,g as ee}from"../index-w2jt-Wul.js";import{s as xe}from"../sorts-DmEn6gXZ.js";function Ve(k){return typeof k=="string"?new Date(k):k}function ke(k,w,E){return k.map(T=>({...T,[w]:E(T[w])}))}const we={class:"flex-col gap-8px m-24px mb-64px"},_e={class:"flex-center w-full gap-4px"},De={class:"flex-1"},Ue={class:"flex-1"},Te=["onClick"],$e={class:"flex-col gap-8px"},Se={class:"flex items-center justify-between w-full"},Ee=ie({__name:"App",setup(k){const w=ge(4),E=p(()=>[{title:"日期",key:"date",nowrap:!0,sortable:!1},{title:`賣出${J.value}`,key:"sell",nowrap:!0,sortable:!1,align:"end"},{title:`買入${$.value}`,key:"buy",nowrap:!0,sortable:!1,align:"end"},{title:"匯率",key:"exchangeRate",nowrap:!0,sortable:!1},{title:`剩餘${$.value}`,key:"balance",nowrap:!0,sortable:!1,align:"end"},{key:"actions",sortable:!1}]),T=p(()=>N.value.map(l=>{var e,n,m,s,y,f;return{...l,sell:j(l.sell,(e=u.value)==null?void 0:e.locale,(n=u.value)==null?void 0:n.localCurrencyCode),buy:j(l.buy,(m=u.value)==null?void 0:m.locale,(s=u.value)==null?void 0:s.foreignCurrencyCode),balance:j(l.balance,(y=u.value)==null?void 0:y.locale,(f=u.value)==null?void 0:f.foreignCurrencyCode)}})),N=p(()=>{let l=F.value;return xe(ke(R.value,"date",Ve),"date","desc").map(e=>{const n=l>e.buy?e.buy:l;return l-=n,{id:e.id,date:Q(e.date,"yyyy/MM/dd"),sell:e.sell,buy:e.buy,exchangeRate:w(e.sell/e.buy),balance:n}})}),ae=p(()=>{let l=0,e=0;for(const n of N.value)n.balance>0&&(e+=n.balance,l+=n.balance*n.exchangeRate);return e===0?0:w(l/e)}),_=g(!1),x=g(!1),d=g(null),v=g({}),u=p(()=>d.value!==null?v.value[d.value]??null:null),R=p(()=>{var l;return((l=u.value)==null?void 0:l.list)??[]}),F=p(()=>{var l;return((l=u.value)==null?void 0:l.amount)??0}),te=p(()=>Object.entries(v.value).map(([l,{title:e}])=>({id:l,title:e}))),J=p(()=>{var l;return U((l=u.value)==null?void 0:l.localCurrencyCode)?` ${u.value.localCurrencyCode}`:"本幣"}),$=p(()=>{var l;return U((l=u.value)==null?void 0:l.foreignCurrencyCode)?` ${u.value.foreignCurrencyCode}`:"外幣"});ve(()=>{v.value=X.get("averageExchangeRate")??{},M()});function M(){Object.keys(v.value).length===0&&z();const l=Object.keys(v.value)[0];Ce(l)&&(d.value=l)}S(_,()=>{i.value=L()});function L(){return{sell:0,buy:0,date:Q(new Date,"yyyy-MM-dd'T'HH:mm")}}const i=g(L()),o=g(null);function ne(){const{buy:l,sell:e}=i.value,n=new Date(i.value.date).toISOString(),m=ee();V("list",[{buy:l,sell:e,date:n,id:m},...R.value]),_.value=!1}function z(){const l=ee();v.value[l]=Z(),d.value=l}S(v,()=>{X.set("averageExchangeRate",v.value)},{deep:!0});function V(l,e){if(d.value===null)return;const n=v.value[d.value]??Z();n[l]=e}S(x,l=>{if(l)u.value!==null&&(o.value={title:u.value.title,localCurrencyCode:u.value.localCurrencyCode??"",foreignCurrencyCode:u.value.foreignCurrencyCode??"",locale:u.value.locale??"",config:JSON.stringify(u.value,null,2)});else{o.value=null;return}});function ue(){if(o.value===null)return;const{title:l,localCurrencyCode:e,foreignCurrencyCode:n,locale:m,config:s}=o.value,y=W(s);y!==null&&d.value!==null&&JSON.stringify(y)!==JSON.stringify(u.value)?v.value[d.value]=y:(be({locale:m,localCurrencyCode:e,foreignCurrencyCode:n}),V("title",l),V("localCurrencyCode",U(e)?e:null),V("foreignCurrencyCode",U(n)?n:null),V("locale",U(m)?m:null)),x.value=!1}const b=g(null);function oe({id:l}){b.value={message:"確定要刪除這筆資料嗎？",event:()=>{V("list",[...R.value].filter(e=>e.id!==l)),b.value=null}}}function se(l){l!==null&&(b.value={message:"確定要刪除這張表嗎？",event:()=>{delete v.value[l],M(),b.value=null,x.value=!1}})}function A(l){const e=parseFloat(l);return isNaN(e)?0:e}const H=g(!0);S(()=>{var l;return(l=o.value)==null?void 0:l.config},l=>{H.value=!!W(l)});function W(l){if(l===void 0)return null;let e;try{e=JSON.parse(l)}catch{return null}return pe(e)?e:null}return(l,e)=>{const n=C("v-tab"),m=C("v-tabs"),s=C("v-text-field"),y=C("v-data-table"),f=C("v-btn"),I=C("v-card"),B=C("v-dialog"),re=C("v-textarea");return D(),O(q,null,[c("main",we,[t(m,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=a=>d.value=a),"align-tabs":"center",color:"deep-purple-accent-4"},{default:r(()=>[(D(!0),O(q,null,ce(te.value,({id:a,title:h},de)=>(D(),P(n,{key:de,value:a},{default:r(()=>[Y(K(h)+" ",1),a===d.value?(D(),O("p",{key:0,class:"flex-center w-24px h-24px",onClick:e[0]||(e[0]=Ne=>x.value=!0)},e[18]||(e[18]=[c("i",{class:"fa-solid fa-pen ml-4px"},null,-1)]))):G("",!0)]),_:2},1032,["value"]))),128)),t(n,{onClick:z},{default:r(()=>e[19]||(e[19]=[c("i",{class:"fas text-16px fa-plus"},null,-1)])),_:1})]),_:1},8,["modelValue"]),c("div",_e,[c("div",De,[t(s,{"model-value":F.value,label:`剩餘${$.value}`,"hide-details":"auto",inputmode:"decimal","onUpdate:modelValue":e[2]||(e[2]=a=>V("amount",A(a)))},null,8,["model-value","label"])]),c("div",Ue,[t(s,{"model-value":ae.value,"hide-details":"auto",label:"平均匯率",disabled:""},null,8,["model-value"])])]),t(y,{headers:E.value,items:T.value},{"item.actions":r(({item:a})=>[c("i",{class:"fa-solid fa-trash",onClick:h=>oe(a)},null,8,Te)]),_:1},8,["headers","items"]),c("div",{class:"fixed bottom-24px right-24px",onClick:e[3]||(e[3]=a=>_.value=!0)},[t(f,{icon:"mdi-plus"})])]),t(B,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=a=>_.value=a)},{default:r(()=>[t(I,{title:"Add Item"},{text:r(()=>[t(s,{modelValue:i.value.date,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value.date=a),type:"datetime-local","hide-details":"auto",label:"交易日期"},null,8,["modelValue"]),t(s,{"model-value":i.value.sell,"hide-details":"auto",inputmode:"decimal",label:`賣出${J.value}`,"onUpdate:modelValue":e[5]||(e[5]=a=>i.value.sell=A(a))},null,8,["model-value","label"]),t(s,{"model-value":i.value.buy,"hide-details":"auto",inputmode:"decimal",label:`買入${$.value}`,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value.buy=A(a))},null,8,["model-value","label"]),t(s,{"hide-details":"auto",label:"平均匯率","model-value":i.value.buy===0?0:me(w)(i.value.sell/i.value.buy),disabled:""},null,8,["model-value"])]),actions:r(()=>[t(f,{class:"ms-auto",text:"Submit",onClick:ne})]),_:1})]),_:1},8,["modelValue"]),t(B,{modelValue:x.value,"onUpdate:modelValue":e[15]||(e[15]=a=>x.value=a)},{default:r(()=>[o.value!==null?(D(),P(I,{key:0,title:"Setting"},{text:r(()=>[c("div",$e,[t(s,{modelValue:o.value.title,"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.title=a),"hide-details":"auto",label:"標籤名稱"},null,8,["modelValue"]),t(s,{modelValue:o.value.locale,"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.locale=a),"hide-details":"auto",label:"語系代碼",placeholder:"zh-TW"},null,8,["modelValue"]),t(s,{modelValue:o.value.localCurrencyCode,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.localCurrencyCode=a),"hide-details":"auto",label:"本幣代碼",placeholder:"TWD"},null,8,["modelValue"]),t(s,{modelValue:o.value.foreignCurrencyCode,"onUpdate:modelValue":e[11]||(e[11]=a=>o.value.foreignCurrencyCode=a),"hide-details":"auto",label:"外幣代碼",placeholder:"JPY"},null,8,["modelValue"]),t(re,{modelValue:o.value.config,"onUpdate:modelValue":e[12]||(e[12]=a=>o.value.config=a),"error-messages":H.value?"":"json 無效",label:"設定檔",messages:"若有修改到設定檔上方其他設定就會忽略"},null,8,["modelValue","error-messages"])])]),actions:r(()=>[c("div",Se,[t(f,{text:"刪除",color:"red",onClick:e[13]||(e[13]=a=>se(d.value))}),c("div",null,[t(f,{text:"取消",onClick:e[14]||(e[14]=a=>x.value=!1)}),t(f,{text:"儲存",color:"blue",onClick:ue})])])]),_:1})):G("",!0)]),_:1},8,["modelValue"]),t(B,{"model-value":!!b.value,"onUpdate:modelValue":e[17]||(e[17]=a=>b.value=null)},{default:r(()=>[t(I,{class:"mx-auto","max-width":"320",title:"Update Field"},{text:r(()=>{var a;return[Y(K(((a=b.value)==null?void 0:a.message)??""),1)]}),actions:r(()=>{var a;return[t(f,{class:"ms-auto",text:"取消",onClick:e[16]||(e[16]=h=>b.value=null)}),t(f,{class:"ms-auto",color:"red",text:"刪除",onClick:(a=b.value)==null?void 0:a.event},null,8,["onClick"])]}),_:1})]),_:1},8,["model-value"])],64)}}}),le=fe(Ee);le.use(ye);le.mount("#app");
//# sourceMappingURL=averageExchangeRate-ppSVwaxC.js.map
