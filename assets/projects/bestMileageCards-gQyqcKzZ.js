var $e=Object.defineProperty;var Ve=(o,e,a)=>e in o?$e(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a;var C=(o,e,a)=>Ve(o,typeof e!="symbol"?e+"":e,a);import{b as R,o as Ne,c as Z,f as H,d as te,B as P,g as f,j as b,k as h,x as d,C as w,u as k,E as Oe,G as De,v as N,D as z,t as M,y as j,F as O,l as W,e as Ae,w as Ce,H as Fe,m as Je,I as Ke,K as Ge,A as je}from"../index-DE32VpUz.js";import{d as ze,s as se,c as We}from"../pinia-ujxmj9Ty.js";import{C as Xe,v as He}from"../StorageManager-DVcQTi15.js";import{a as Te,b as Re}from"../sorts-BPW8KRTv.js";import{f as Le,r as ne,b as ke,g as ue,a as pe}from"../index-f1g9dClV.js";import{_ as Ye}from"../_plugin-vue_export-helper-DlAUqK2U.js";const Be=Le(0),qe=ne(0),Se=ne(2);class me{constructor({type:e,name:a}){C(this,"_name");C(this,"_type");this._type=e,this._name=a}get name(){return this._name}get type(){return this._type}calculateRangePointsCost(e,a){const n=[];for(let p=e;p<=a;p++){const y=Se(p/this.calculatePoints(p));isNaN(y)||y===1/0||y===-1/0||n.push(y)}n.sort((p,y)=>p-y);const i=n[n.length-1],c=n[0];if(i===void 0||c===void 0)throw new Error("cannot be calculated");const v=n.reduce((p,y)=>p+y,0)/n.length;return{max:i,min:c,average:Se(v)}}}class Ze extends me{constructor({pointBackRates:a,...n}){super(n);C(this,"_pointBackRates");this._pointBackRates=a}get _maxRete(){return this._pointBackRates.reduce((a,{rate:n})=>a+n,0)}get pointBackRates(){return this._pointBackRates}get description(){return`消費${this._pointBackRates.length>1?"最高":""}${this._maxRete.toString()}%回饋點數(四捨五入)`}calculatePoints(a){let n=0;for(const{rate:i,limit:c=1/0}of this._pointBackRates)n+=Math.min(qe(a*(i/100)),c);return n}toJSON(){return{name:this._name,type:this._type,pointBackRates:this._pointBackRates}}}class Qe extends me{constructor({pointBackRates:a,...n}){super(n);C(this,"_pointBackRates");this._pointBackRates=a}get _maxRete(){return this._pointBackRates.reduce((a,{rate:n})=>a+n,0)}get pointBackRates(){return this._pointBackRates}get description(){return`消費${this._pointBackRates.length>1?"最高":""}${this._maxRete.toString()}%回饋點數(無條件捨去)`}calculatePoints(a){let n=0;for(const{rate:i,limit:c=1/0}of this._pointBackRates)n+=Math.min(Be(a*(i/100)),c);return n}toJSON(){return{name:this._name,type:this._type,pointBackRates:this._pointBackRates}}}class et extends me{constructor({spendingPerPoint:a,...n}){super({...n});C(this,"_spendingPerPoint");this._spendingPerPoint=a}get spendingPerPoint(){return this._spendingPerPoint}get description(){return`每消費${this._spendingPerPoint.toString()}元累積1點 (小數會累計)`}calculatePoints(a){return Se(a/this._spendingPerPoint)}toJSON(){return{name:this._name,type:this._type,spendingPerPoint:this._spendingPerPoint}}}class tt extends me{constructor({spendingPerPoint:a,...n}){super({...n});C(this,"_spendingPerPoint");this._spendingPerPoint=a}get spendingPerPoint(){return this._spendingPerPoint}get description(){return`每消費${this._spendingPerPoint.toString()}元累積1點 (小數不累計)`}calculatePoints(a){return Be(a/this._spendingPerPoint)}toJSON(){return{name:this._name,type:this._type,spendingPerPoint:this._spendingPerPoint}}}const at={RoundedPercentageReward:Ze,TruncatedPercentageReward:Qe,AccumulatedPointsReward:et,FixedRatePointsReward:tt};function nt(o){return new at[o.type](o)}class st{constructor(e,a,n){C(this,"_name");C(this,"_rewards");C(this,"_condition");if(this._name=e,this._condition=a,n.length===0)throw new Error(`Plan "${e??"unknown"}" must have at least one reward rule.`);this._rewards=n}get name(){return this._name}get storeList(){return ke(this._rewards.flatMap(e=>[...e.stores,...e.storeBlackList]))}checkPlanIsVisible(e){return this._condition===null||!!(e!=null&&e.includes(this._condition))}getApplicableReward({transactionStore:e=null,acceptedPayments:a=[],transactionAttributesType:n,currentConditions:i=null}){return this._condition!==null&&!(i!=null&&i.includes(this._condition))?null:this._rewards.find(({stores:c,payments:v,transactionType:p,paymentBlackList:y,storeBlackList:A,condition:r})=>{const _=e===null||c.size===0||c.has(e),S=e===null||A.size===0||!A.has(e),t=a.length===0||v.size===0||a.some(I=>v.has(I)),u=a.length===0||y.size===0||a.some(I=>!y.has(I)),D=p===null||n===p,B=r===null||!!(i!=null&&i.includes(r));return _&&S&&t&&u&&D&&B})??null}getRewardMiles({transactionStore:e,acceptedPayments:a,amount:n,transactionAttributesType:i,currentConditions:c}){const v=this.getApplicableReward({acceptedPayments:a,transactionStore:e,transactionAttributesType:i,currentConditions:c});if(v===null)return null;const p=a===void 0?[...v.payments.values()]:a.filter(y=>v.payments.has(y));return{rewardName:v.rewardStrategy.name,rewardPoints:v.rewardStrategy.calculatePoints(n),payments:p.filter(y=>!v.paymentBlackList.has(y)),rewardStrategy:v.rewardStrategy}}toJSON(){return{name:this._name,condition:this._condition,rewards:this._rewards.map(({rewardStrategy:e,stores:a,payments:n,transactionType:i,paymentBlackList:c,storeBlackList:v,condition:p})=>({rewardStrategy:e.toJSON(),stores:[...a],storeBlackList:[...v],payments:[...n],paymentBlackList:[...c],transactionType:i,condition:p}))}}}const lt=["信用卡","Apple Pay","Samsung Pay","Google Pay","Line Pay","Fitbit Pay","Garmin Pay","Hami Pay","街口支付","全盈+PAY","全支付","Pi錢包","橘子支付","歐付寶","icash pay","OPEN錢包","My FamiPay","悠遊付","ezPay","GOMAJI Pay","friday wallet","PayPal","PX Pay","中油Pay","台灣Pay","支付寶"];class ot{constructor({name:e,description:a,plans:n,storeBlackList:i,paymentBlackList:c,cardUrl:v,updateAt:p,pointExchangeStrategies:y}){C(this,"_selectedPlanId");C(this,"_selectedPointExchangeStrategyId");C(this,"_name");C(this,"_description");C(this,"_plans");C(this,"_cardUrl");C(this,"_storeBlackList");C(this,"_paymentBlackList");C(this,"_updateAt");C(this,"_pointExchangeStrategies");this._name=e,this._description=a,this._plans=n,this._cardUrl=v,this._storeBlackList=i,this._paymentBlackList=c,this._updateAt=p,this._pointExchangeStrategies=y;const A=this._plans.keys().next().value;if(this._plans.size===0||A===void 0)throw new Error("this credit card no any plan");this._selectedPlanId=A;const r=this._pointExchangeStrategies.keys().next().value;if(this._plans.size===0||r===void 0)throw new Error("this credit card no any exchange strategy");this._selectedPointExchangeStrategyId=r}get name(){return this._name}get description(){return this._description}get selectedPlanId(){return this._selectedPlanId}get selectedPlan(){return this._getPlan(this._selectedPlanId)}get selectedPointExchangeStrategyId(){return this._selectedPointExchangeStrategyId}get selectedPointExchangeStrategy(){return this._getPointExchangeStrategy(this._selectedPointExchangeStrategyId)}get selectablePlan(){return[...this._plans.entries()].map(([e,{name:a}])=>({id:e,name:a}))}get storeList(){return ke([...[...this._plans.values()].flatMap(e=>e.storeList),...this._storeBlackList])}get cardUrl(){return this._cardUrl}_getPlan(e){const a=this._plans.get(e);if(a===void 0)throw new Error(`plan id ${e} not found. Available plans: ${[...this._plans.keys()].join(", ")}`);return a}_getPointExchangeStrategy(e){const a=this._pointExchangeStrategies.get(e);if(a===void 0)throw new Error(`pointExchangeStrategy id ${e} not found. Available pointExchangeStrategies: ${[...this._plans.keys()].join(", ")}`);return a}_rewardMilesWithPlan(e,a,n){var r;const i=this._getPlan(e),c=this._getPointExchangeStrategy(a),v={planId:e,planName:i.name,rewardName:null,rewardPoints:0,payments:[],rewardStrategy:null,pointExchangeStrategy:c,pointExchangeName:c.name,airlineCode:c.airlineCode,miles:0},p=n.transactionStore!==void 0&&this._storeBlackList.has(n.transactionStore),y=(r=n.acceptedPayments)==null?void 0:r.some(_=>this._paymentBlackList.has(_));if(p||y)return v;const A=i.getRewardMiles(n);return A===null?v:{planId:e,planName:i.name,pointExchangeStrategy:c,pointExchangeName:c.name,miles:c.calculateMiles(A.rewardPoints),airlineCode:c.airlineCode,...A}}updatePlan(e){return this._plans.get(e)?(this._selectedPlanId=e,!0):!1}updatePointExchangeStrategy(e){return this._pointExchangeStrategies.get(e)?(this._selectedPointExchangeStrategyId=e,!0):!1}getRewardInfos(e,{onlyCurrentPlan:a=!1,onlyCurrentExchangeStrategy:n=!1}={}){const i=a?[[this._selectedPlanId,this.selectedPlan]]:[...this._plans.entries()],c=n?[this._selectedPointExchangeStrategyId]:[...this._pointExchangeStrategies.keys()],v=[];for(const[p,y]of i)if(y.checkPlanIsVisible(e.currentConditions??null))for(const r of c){const _=this._rewardMilesWithPlan(p,r,e);v.push(_)}return v}toJSON(){return{name:this._name,description:this._description,cardUrl:this._cardUrl,storeBlackList:[...this._storeBlackList],paymentBlackList:[...this._paymentBlackList],plans:[...this._plans].sort(([e])=>e===this._selectedPlanId?-1:1).map(([e,a])=>a.toJSON()),updateAt:this._updateAt.toISOString(),pointExchangeStrategies:[...this._pointExchangeStrategies].sort(([e])=>e===this._selectedPointExchangeStrategyId?-1:1).map(([e,a])=>a.toJSON())}}}const rt=ne(2);class it{constructor({name:e,airlineCode:a,pointsPerMile:n,milesPerUnit:i}){C(this,"_name");C(this,"_airlineCode");C(this,"_pointsPerMile");C(this,"_milesPerUnit");this._name=e,this._airlineCode=a,this._pointsPerMile=n,this._milesPerUnit=i}get name(){return this._name}get description(){return`${this._pointsPerMile}點可以交換${this._milesPerUnit}哩程`}get airlineCode(){return this._airlineCode}get pointsPerMile(){return this._pointsPerMile}get milesPerUnit(){return this._milesPerUnit}calculateMiles(e){return rt(e*this._milesPerUnit/this._pointsPerMile)}toJSON(){return{name:this._name,airlineCode:this._airlineCode,pointsPerMile:this._pointsPerMile,milesPerUnit:this._milesPerUnit}}}function dt({name:o,description:e,storeBlackList:a,paymentBlackList:n,cardUrl:i,plans:c,updateAt:v,pointExchangeStrategies:p}){const y=new Map(c.map(({name:A,condition:r,rewards:_})=>[ue(),new st(A,r??null,_.map(({stores:S,payments:t,transactionType:u,rewardStrategy:D,paymentBlackList:B,storeBlackList:I,condition:J})=>({rewardStrategy:nt(D),stores:new Set(S),storeBlackList:new Set(I),payments:new Set(t),paymentBlackList:new Set(B),transactionType:u??null,condition:J??null})))]));return new ot({name:o,description:e,plans:y,storeBlackList:new Set(a),paymentBlackList:new Set(n),cardUrl:i,updateAt:new Date(v),pointExchangeStrategies:new Map(p.map(A=>[ue(),new it(A)]))})}const oe=["分期付款"],re=[],ge=["信用卡","Apple Pay","Samsung Pay","Google Pay","Fitbit Pay","Garmin Pay","Hami Pay"];function ie(o){const e={rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:.3}]}};return[{name:"集精選",rewards:[{rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:2}]},stores:["家樂福","LOPIA台灣","全聯福利中心","台灣中油-直營","7-ELEVEN","全家便利商店","IKEA"],payments:[...ge,"PX Pay","My FamiPay","OPEN錢包"]},e]},{name:"玩數位",rewards:[{rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:o}]},stores:["App Store","Apple Music","iCloud","Apple TV+","Apple Arcade","Apple One","iTunes","Google Play","Disney+","Netflix","Spotify","KKBOX","YouTube Premium","蝦皮購物","momo購物網","PChome 24h購物(不含儲值及電子票券)","博客來","小樹購","Coupang 酷澎(台灣)","淘寶/天貓"],paymentBlackList:["Line Pay","街口支付"]},{...e,storeBlackList:["全聯福利中心"]}]},{name:"樂饗購",rewards:[{rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:o}]},stores:["遠東SOGO百貨","遠東Garden City","太平洋百貨","新光三越","SKM Park","BELLAVITA","微風廣場","遠東百貨","Big City遠東巨城購物中心","誠品生活","環球購物中心","CITYLINK","統一時代","台北101","ATT 4 FUN","明曜百貨","京站","美麗華","大葉高島屋","比漾廣場","大江國際購物中心","中友百貨","廣三SOGO","Tiger City","勤美誠品綠園道","大魯閣新時代","耐斯廣場","南紡購物中心","夢時代","漢神百貨","漢神巨蛋","MITSUI OUTLET PARK 林口","MITSUI OUTLET PARK 台中港","MITSUI OUTLET PARK 台南","Mitsui Shopping Park LaLaport 台中","義大世界購物廣場","華泰名品城","義享天地","麗寶OUTLET Mall","秀泰生活","台茂購物中心","新月廣場","三創生活","宏匯廣場","高雄棧貳庫/大港倉","NOKE忠泰樂生活","Uber Eats","foodpanda","foodomo","國內餐飲(不含餐券)","麥當勞","康是美","屈臣氏"],payments:ge},{...e,storeBlackList:["全聯福利中心"]}]},{name:"趣旅行",rewards:[{rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:o}]},stores:["海外實體消費","東京迪士尼樂園","東京華納兄弟哈利波特影城","大阪環球影城(USJ)","吉卜力公園","Apple Wallet SUICA","Apple Wallet PASMO","Apple Wallet ICOCA","Uber","Grab","台灣高鐵","yoxi","台灣大車隊","iRent","和運租車","格上租車","中華航空","長榮航空","星宇航空","台灣虎航","國泰航空","樂桃航空","阿聯酋航空","酷航","捷星航空","日本航空","亞洲航空","聯合航空","ANA全日空","新加坡航空","越捷航空","大韓航空","達美航空","土耳其航空","卡達航空","法國航空","國內飯店住宿","星野集團","全球迪士尼飯店","東橫INN","KKday","Agoda","Klook","Airbnb","Hotels.com","Expedia","Booking.com","Trip.com","AsiaYo","ezTravel易遊網","雄獅旅遊","可樂旅遊","東南旅遊","五福旅遊","燦星旅遊","山富旅遊","長汎假期","鳳凰旅行社","Ezfly易飛網","理想旅遊","永利旅行社","三賀旅行社","173WIFI","JetFi mobile","威訊 WaySim","AIRSIM","SIM88"],payments:ge},{...e,storeBlackList:["全聯福利中心"]}]},{name:"來支付",rewards:[{rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:2}]},payments:["Line Pay"]},{...e,storeBlackList:["全聯福利中心"]}]},{name:"慶生月",condition:"Birthday",rewards:[{rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:10}]},stores:["東京迪士尼樂園","大阪環球影城(USJ)","名古屋樂高樂園","紅葉蛋糕官方網站","法朋烘焙甜點坊","興波咖啡 華山旗艦店","海底撈火鍋","輕井澤鍋物","老四川巴蜀麻辣燙","二本松涮涮屋","橋山.壽喜燒","Umai屋馬燒肉","老井極上燒肉","燒肉中山(台中大墩)","藏壽司台灣","貳樓","膳馨民間創作料理","馨苑小料理","雅室牛排 仁愛圓環店","ABV餐飲集團","WAT","臺虎精釀(信義 | 西門 | 臺中 | 啜飲室大安)","BAR Bodega","BAR MED","JiN Her 今鶴","錢櫃KTV","好樂迪KTV","星聚點KTV","享溫馨KTV","Nintendo","巴哈姆特動畫瘋","閃動格子CyberCube"]},{rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:3.5}]},stores:["新光三越","Uber Eats (不含 Uber One)","Agoda","Trip.com","Klook","國內飯店住宿","星野集團","全球迪士尼飯店","東橫INN"]},{...e,storeBlackList:["全聯福利中心"]}]}]}const ve=[{name:"長榮航空哩程",airlineCode:"EVA",pointsPerMile:360,milesPerUnit:1e3},{name:"長榮航空哩程 + 長榮世界卡",airlineCode:"EVA",pointsPerMile:300,milesPerUnit:1e3}],ct=[{name:"Cube 卡",description:"Cube 卡 (Level 1) 回饋方案",cardUrl:"https://www.cathaybk.com.tw/cathaybk/personal/product/credit-card/cards/cube/",storeBlackList:oe,paymentBlackList:re,updateAt:"2024-12-01T00:00:00.000Z",plans:ie(2),pointExchangeStrategies:ve},{name:"Cube 卡",description:"Cube 卡 (Level 2) 回饋方案",cardUrl:"https://www.cathaybk.com.tw/cathaybk/personal/product/credit-card/cards/cube/",storeBlackList:oe,paymentBlackList:re,updateAt:"2024-12-01T00:00:00.000Z",plans:ie(3),pointExchangeStrategies:ve},{name:"Cube 卡",description:"Cube 卡 (Level 3) 回饋方案",cardUrl:"https://www.cathaybk.com.tw/cathaybk/personal/product/credit-card/cards/cube/",storeBlackList:oe,paymentBlackList:re,updateAt:"2024-12-01T00:00:00.000Z",plans:ie(3.3),pointExchangeStrategies:ve}],ut={name:"Cube 卡",description:"Cube 卡 (Level 2) 回饋方案",cardUrl:"https://www.cathaybk.com.tw/cathaybk/personal/product/credit-card/cards/cube/",storeBlackList:oe,paymentBlackList:re,updateAt:"2024-12-01T00:00:00.000Z",plans:ie(3),pointExchangeStrategies:[{name:"長榮航空哩程",airlineCode:"EVA",pointsPerMile:360,milesPerUnit:1e3}]},de=["政府稅款","公共事業代扣繳","交通違規罰鍰","分期付款","全聯福利中心","7-ELEVEN","全家便利商店"],ce=[],pt=[{name:"星宇世界卡",description:null,cardUrl:"https://www.esunbank.com/zh-tw/personal/credit-card/intro/co-branded-card/starlux-card",storeBlackList:de,paymentBlackList:ce,pointExchangeStrategies:[{name:"星宇航空哩程",airlineCode:"SJX",pointsPerMile:1,milesPerUnit:1}],plans:[{name:null,rewards:[{rewardStrategy:{type:"FixedRatePointsReward",name:"國外消費",spendingPerPoint:5},transactionType:"Foreign",condition:"Birthday"},{rewardStrategy:{type:"FixedRatePointsReward",name:"國外消費",spendingPerPoint:10},transactionType:"Foreign"},{rewardStrategy:{type:"FixedRatePointsReward",name:"國內消費",spendingPerPoint:20},transactionType:"Domestic"}]}],updateAt:new Date("2024/12/01 00:00:00").toISOString()},{name:"星宇商務鈦金卡",description:null,cardUrl:"https://www.esunbank.com/zh-tw/personal/credit-card/intro/co-branded-card/starlux-card",storeBlackList:de,paymentBlackList:ce,pointExchangeStrategies:[{name:"星宇航空哩程",airlineCode:"SJX",pointsPerMile:1,milesPerUnit:1}],plans:[{name:null,rewards:[{rewardStrategy:{type:"FixedRatePointsReward",name:"國外消費",spendingPerPoint:7.5},transactionType:"Foreign",condition:"Birthday"},{rewardStrategy:{type:"FixedRatePointsReward",name:"國外消費",spendingPerPoint:15},transactionType:"Foreign"},{rewardStrategy:{type:"FixedRatePointsReward",name:"國內消費",spendingPerPoint:25},transactionType:"Domestic"}]}],updateAt:new Date("2024/12/01 00:00:00").toISOString()},{name:"星宇鈦金卡",description:null,cardUrl:"https://www.esunbank.com/zh-tw/personal/credit-card/intro/co-branded-card/starlux-card",storeBlackList:de,paymentBlackList:ce,pointExchangeStrategies:[{name:"星宇航空哩程",airlineCode:"SJX",pointsPerMile:1,milesPerUnit:1}],plans:[{name:null,rewards:[{rewardStrategy:{type:"FixedRatePointsReward",name:"國外消費",spendingPerPoint:20},transactionType:"Foreign"},{rewardStrategy:{type:"FixedRatePointsReward",name:"國內消費",spendingPerPoint:28},transactionType:"Domestic"}]}],updateAt:new Date("2024/12/01 00:00:00").toISOString()}],_e=["台灣中油-直營","台灣大車隊","台鐵","台灣高鐵","UBER","Yoxi","LINEGO","新光三越","遠東百貨","遠東SOGO百貨","誠品生活","漢神百貨","微風廣場","微風信義","微風南京","微風南山","微風台北車站","環球購物中心","台北101","華泰名品城","MITSUI OUTLET PARK 林口","MITSUI OUTLET PARK 台中港","MITSUI OUTLET PARK 台南","Big City遠東巨城購物中心","昇恆昌","夢時代購物中心","京站","美麗華","南紡購物中心","秀泰生活","台茂購物中心","Mitsui Shopping Park LaLaport 台中","統領廣場","采盟","Uber Eats","foodpanda","星巴克","EZTABLE","王品瘋美食","摩斯漢堡","foodomo","漢來美食","饗Joy","饗食天堂","果然匯","小福利","饗饗","旭集","開飯","饗泰多","真珠","瓦城","非常泰","大心","1010","時時香","BOBO","乾杯集團","路易莎","中華航空","長榮航空","日本航空","台灣虎航","樂桃航空","酷航","立榮航空","華信航空","Agoda","booking.com","Hotels.com","AsiaYo","Expedia","KKday","Klook","雄獅旅遊","可樂旅遊","東南旅行社","Apple直營店","小米台灣","全國電子","燦坤","迪卡儂","屈臣氏","康是美","IKEA","特力屋","特力和樂","UNIQLO","NET","大樹藥局","丁丁藥妝","momo購物網","蝦皮購物","淘寶網","Coupang酷澎","東森購物","雅虎奇摩購物中心","博客來","玉山Wallet愛心捐款-單筆捐款","玉山Wallet愛心捐款-定期定額","特斯拉","Gogoro電池資費","YouBike 2.0","日本實體店","韓國實體店","泰國實體店","越南實體店","新加坡實體店","中國實體店","香港實體店","澳門實體店","美國實體店","英國實體店","法國實體店","德國實體店","義大利實體店"],Pe={rewardStrategy:{type:"TruncatedPercentageReward",name:null,pointBackRates:[{rate:.3},{rate:.7}]}},Me=[{name:"UniCard 卡",description:null,cardUrl:"https://www.esunbank.com/zh-tw/personal/credit-card/intro/bank-card/unicard",storeBlackList:de,paymentBlackList:ce,pointExchangeStrategies:[{name:"長榮航空哩程",airlineCode:"EVA",pointsPerMile:200,milesPerUnit:300}],plans:[{name:"任意選 (需要切換店家)",rewards:[{rewardStrategy:{type:"TruncatedPercentageReward",name:null,pointBackRates:[{rate:.3},{rate:.7},{rate:2.5,limit:500}]},stores:_e,payments:["信用卡","Apple Pay","Samsung Pay","Google Pay"]},{rewardStrategy:{type:"TruncatedPercentageReward",name:null,pointBackRates:[{rate:.3},{rate:.7},{rate:2.5,limit:500}]},payments:["Line Pay","街口支付","悠遊付","橘子支付","icash pay"]},Pe]},{name:"簡單選",rewards:[{rewardStrategy:{type:"TruncatedPercentageReward",name:null,pointBackRates:[{rate:.3},{rate:.7},{rate:2,limit:500}]},stores:_e,payments:["信用卡","Apple Pay","Samsung Pay","Google Pay"]},{rewardStrategy:{type:"TruncatedPercentageReward",name:null,pointBackRates:[{rate:.3},{rate:.7},{rate:2,limit:500}]},payments:["Line Pay","街口支付","悠遊付","橘子支付","icash pay"]},Pe]},{name:"UP選",rewards:[{rewardStrategy:{type:"TruncatedPercentageReward",name:null,pointBackRates:[{rate:.3},{rate:.7},{rate:3.5,limit:2e3}]},stores:_e,payments:["信用卡","Apple Pay","Samsung Pay","Google Pay"]},{rewardStrategy:{type:"TruncatedPercentageReward",name:null,pointBackRates:[{rate:.3},{rate:.7},{rate:3.5,limit:2e3}]},payments:["Line Pay","街口支付","悠遊付","橘子支付","icash pay"]},Pe]}],updateAt:new Date("2024/12/01 00:00:00").toISOString()}],mt=Me[0],fe=["政府稅款","公共事業代扣繳","交通違規罰鍰","分期付款"],he=["全盈+PAY","icash pay","OPEN錢包","My FamiPay"],Ee=[{name:"旅人無限卡",description:null,cardUrl:"https://www.hsbc.com.tw/credit-cards/products/travel/visa-infinite/",storeBlackList:fe,paymentBlackList:he,pointExchangeStrategies:[{name:"長榮航空哩程",airlineCode:"EVA",pointsPerMile:1,milesPerUnit:1}],plans:[{name:null,rewards:[{rewardStrategy:{type:"AccumulatedPointsReward",name:"國外消費",spendingPerPoint:10},transactionType:"Foreign"},{rewardStrategy:{type:"AccumulatedPointsReward",name:"國內消費",spendingPerPoint:18},transactionType:"Domestic"}]}],updateAt:new Date("2024/12/01 00:00:00").toISOString()},{name:"旅人御璽卡",description:null,cardUrl:"https://www.hsbc.com.tw/credit-cards/products/travel/visa-signature/",storeBlackList:fe,paymentBlackList:he,pointExchangeStrategies:[{name:"長榮航空哩程",airlineCode:"EVA",pointsPerMile:1,milesPerUnit:1}],plans:[{name:null,rewards:[{rewardStrategy:{type:"AccumulatedPointsReward",name:"國外消費",spendingPerPoint:15},transactionType:"Foreign"},{rewardStrategy:{type:"AccumulatedPointsReward",name:"國內消費",spendingPerPoint:18},transactionType:"Domestic"}]}],updateAt:new Date("2024/12/01 00:00:00").toISOString()},{name:"旅人輕旅卡",description:null,cardUrl:"https://www.hsbc.com.tw/credit-cards/products/travel/visa-light/",storeBlackList:fe,paymentBlackList:he,pointExchangeStrategies:[{name:"長榮航空哩程",airlineCode:"EVA",pointsPerMile:1,milesPerUnit:1}],plans:[{name:null,rewards:[{rewardStrategy:{type:"AccumulatedPointsReward",name:"國外消費",spendingPerPoint:20},transactionType:"Foreign"},{rewardStrategy:{type:"AccumulatedPointsReward",name:"國內消費",spendingPerPoint:20},transactionType:"Domestic"}]}],updateAt:new Date("2024/12/01 00:00:00").toISOString()}],yt=Ee[2],gt=[ut,yt,mt],vt=[...ct,...Ee,...pt,...Me],xe=o=>Array.isArray(o)&&o.every(e=>Array.isArray(e)&&e.length===2&&typeof e[0]=="string"&&Array.isArray(e[1])&&e[1].every(a=>typeof a=="string")),Ue=[["7-ELEVEN",["7-11","Seven Eleven","統一超商","小7"]],["ANA全日空",["ANA","全日空","All Nippon Airways","NH"]],["ATT 4 FUN",["ATT4FUN","ATT信義"]],["App Store",["蘋果應用商店"]],["Apple Arcade",["蘋果遊戲訂閱服務"]],["Apple Music",["蘋果音樂","Apple音樂"]],["Apple One",["蘋果One訂閱"]],["Apple TV+",["Apple TV Plus"]],["Apple Wallet ICOCA",["ICOCA電子票","Apple錢包ICOCA"]],["Apple Wallet PASMO",["PASMO電子票","Apple錢包PASMO"]],["Apple Wallet SUICA",["SUICA電子票","Apple錢包SUICA"]],["CITYLINK",["City Link"]],["Disney+",["Disney Plus","迪士尼+"]],["Google Play",["Google應用商店"]],["Grab",["Grab Taxi","Grab叫車"]],["MITSUI OUTLET PARK 台中港",["三井台中港","三井OUTLET台中"]],["MITSUI OUTLET PARK 台南",["三井台南","三井OUTLET台南"]],["MITSUI OUTLET PARK 林口",["三井林口","三井OUTLET林口"]],["Mitsui Shopping Park LaLaport 台中",["LaLaport台中","三井LaLaport台中"]],["Netflix",["網飛"]],["Nintendo",["任天堂","Switch","老任"]],["PChome 24h購物(不含儲值及電子票券)",["PChome","PChome購物"]],["Tiger City",["老虎城","Tiger City購物中心"]],["Trip.com",["攜程"]],["Uber Eats (不含 Uber One)",["優步外送"]],["foodpanda",["熊貓外送","Food Panda"]],["iCloud",["蘋果雲端","iCloud雲端"]],["iRent",["i Rent"]],["iTunes",["蘋果iTunes"]],["中友百貨",["中友"]],["中華航空",["China Airlines","CAL","CI","華航"]],["亞洲航空",["AirAsia","亞航","AXM","AK"]],["京站",["Q Square","京站商場"]],["全家便利商店",["FamilyMart","全家"]],["全球迪士尼飯店",["Disney Hotels"]],["全聯福利中心",["PX Mart"]],["南紡購物中心",["Tainan Spinnery Mall","南紡"]],["博客來",["Books.com.tw"]],["卡達航空",["Qatar Airways","卡航","QTR","QR"]],["可樂旅遊",["Cola Travel","可樂旅行社"]],["台北101",["Taipei 101","101大樓"]],["台灣中油-直營",["中油直營","直營中油"]],["台灣大車隊",["Taiwan Taxi","大車隊"]],["台灣虎航",["Tigerair Taiwan","台虎","TWA","IT"]],["台灣高鐵",["Taiwan High Speed Rail"]],["台茂購物中心",["TaiMall"]],["吉卜力公園",["Ghibli Park"]],["國泰航空",["Cathay Pacific","國泰","CPA","CX","Cathay Pacific Airways"]],["土耳其航空",["Turkish Airlines","土航","THY","TK"]],["夢時代",["Dream Mall"]],["大阪環球影城(USJ)",["Universal Studios Japan"]],["大韓航空",["Korean Air","韓航","KAL","KE"]],["大魯閣新時代",["Taroko Mall","大魯閣"]],["太平洋百貨",["Pacific Department Store","太平洋"]],["好樂迪KTV",["Holiday"]],["家樂福",["Carrefour"]],["屈臣氏",["Watsons"]],["康是美",["Cosmed"]],["捷星航空",["JST","JQ","Jetstar Airways"]],["新加坡航空",["SIA","SQ","Singapore Airlines"]],["日本航空",["JAL","JL","Japan Airlines"]],["星宇航空",["starlux","SJX","JX","STARLUX Airlines"]],["樂桃航空",["APJ","MM","Peach Aviation"]],["法國航空",["AFR","AF","Air France"]],["聯合航空",["UAL","UA","United Airlines"]],["蝦皮購物",["shopee"]],["越捷航空",["VJC","VJ","VietJet Air"]],["達美航空",["DAL","DL","Delta Air Lines"]],["遠東百貨",["遠百"]],["酷航",["SCO","TR","Scoot"]],["長榮航空",["EVA","BR","EVA Airlines","EVA Air"]],["阿聯酋航空",["UAE","EK","Emirates"]],["麥當勞",["McDonald's"]],["IKEA",["宜家家居"]],["星巴克",["starbucks"]]],_t=o=>o==="AllPlanRewardMiles"||o==="CurrentPlanRewardMiles",F=new Xe(localStorage,{showRewardMilesType:_t,commonPaymentMethods:(()=>{const o=new Set(["信用卡","Apple Pay","Samsung Pay","Google Pay","Line Pay","Fitbit Pay","Garmin Pay","Hami Pay","街口支付","全盈+PAY","全支付","Pi錢包","橘子支付","歐付寶","icash pay","OPEN錢包","My FamiPay","悠遊付","ezPay","GOMAJI Pay","friday wallet","PayPal","PX Pay","中油Pay","台灣Pay","支付寶"]);return e=>Array.isArray(e)&&e.every(a=>o.has(a)===!0)})(),cardConfigs:(()=>{const o=new Set(["信用卡","Apple Pay","Samsung Pay","Google Pay","Line Pay","Fitbit Pay","Garmin Pay","Hami Pay","街口支付","全盈+PAY","全支付","Pi錢包","橘子支付","歐付寶","icash pay","OPEN錢包","My FamiPay","悠遊付","ezPay","GOMAJI Pay","friday wallet","PayPal","PX Pay","中油Pay","台灣Pay","支付寶"]),e=new Set(["信用卡","Apple Pay","Samsung Pay","Google Pay","Line Pay","Fitbit Pay","Garmin Pay","Hami Pay","街口支付","全盈+PAY","全支付","Pi錢包","橘子支付","歐付寶","icash pay","OPEN錢包","My FamiPay","悠遊付","ezPay","GOMAJI Pay","friday wallet","PayPal","PX Pay","中油Pay","台灣Pay","支付寶"]),a=new Set(["信用卡","Apple Pay","Samsung Pay","Google Pay","Line Pay","Fitbit Pay","Garmin Pay","Hami Pay","街口支付","全盈+PAY","全支付","Pi錢包","橘子支付","歐付寶","icash pay","OPEN錢包","My FamiPay","悠遊付","ezPay","GOMAJI Pay","friday wallet","PayPal","PX Pay","中油Pay","台灣Pay","支付寶"]),n=t=>typeof t.name=="string"&&(t.description===null||typeof t.description=="string")&&(t.cardUrl===null||typeof t.cardUrl=="string")&&(t.storeBlackList===void 0||Array.isArray(t.storeBlackList)&&t.storeBlackList.every(u=>typeof u=="string"))&&(t.paymentBlackList===void 0||Array.isArray(t.paymentBlackList)&&t.paymentBlackList.every(u=>o.has(u)===!0))&&Array.isArray(t.plans)&&t.plans.every(u=>typeof u=="object"&&u!==null&&i(u))&&typeof t.updateAt=="string"&&RegExp(/^[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?\x2d[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?\x2d[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?T[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?:[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?:[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?\.[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?Z$/).test(t.updateAt)&&Array.isArray(t.pointExchangeStrategies)&&t.pointExchangeStrategies.every(u=>typeof u=="object"&&u!==null&&_(u)),i=t=>(t.name===null||typeof t.name=="string")&&Array.isArray(t.rewards)&&t.rewards.every(u=>typeof u=="object"&&u!==null&&c(u))&&(t.condition===null||t.condition===void 0||t.condition==="Birthday"),c=t=>typeof t.rewardStrategy=="object"&&t.rewardStrategy!==null&&S(t.rewardStrategy)&&(t.transactionType===null||t.transactionType===void 0||t.transactionType==="Domestic"||t.transactionType==="Foreign")&&(t.stores===void 0||Array.isArray(t.stores)&&t.stores.every(u=>typeof u=="string"))&&(t.storeBlackList===void 0||Array.isArray(t.storeBlackList)&&t.storeBlackList.every(u=>typeof u=="string"))&&(t.payments===void 0||Array.isArray(t.payments)&&t.payments.every(u=>e.has(u)===!0))&&(t.paymentBlackList===void 0||Array.isArray(t.paymentBlackList)&&t.paymentBlackList.every(u=>a.has(u)===!0))&&(t.condition===null||t.condition===void 0||t.condition==="Birthday"),v=t=>Array.isArray(t.pointBackRates)&&t.pointBackRates.every(u=>typeof u=="object"&&u!==null&&p(u))&&(t.name===null||typeof t.name=="string")&&t.type==="RoundedPercentageReward",p=t=>typeof t.rate=="number"&&(t.limit===void 0||typeof t.limit=="number"),y=t=>Array.isArray(t.pointBackRates)&&t.pointBackRates.every(u=>typeof u=="object"&&u!==null&&p(u))&&(t.name===null||typeof t.name=="string")&&t.type==="TruncatedPercentageReward",A=t=>typeof t.spendingPerPoint=="number"&&(t.name===null||typeof t.name=="string")&&t.type==="AccumulatedPointsReward",r=t=>typeof t.spendingPerPoint=="number"&&(t.name===null||typeof t.name=="string")&&t.type==="FixedRatePointsReward",_=t=>(t.name===null||typeof t.name=="string")&&typeof t.airlineCode=="string"&&typeof t.pointsPerMile=="number"&&typeof t.milesPerUnit=="number",S=t=>t.type==="TruncatedPercentageReward"?y(t):t.type==="RoundedPercentageReward"?v(t):t.type==="FixedRatePointsReward"?r(t):t.type==="AccumulatedPointsReward"?A(t):!1;return t=>Array.isArray(t)&&t.every(u=>typeof u=="object"&&u!==null&&n(u))})(),conditionTypes:o=>Array.isArray(o)&&o.every(e=>e==="Birthday"),aliasType:o=>o==="default"||o==="additional"||o==="custom",customAliases:xe},"bestMileageCards"),Ie=["default","additional","custom"],le=ze("BestMileageCards",()=>{const o=R(null);function e(s){o.value=s}function a(){o.value=null}Ne(()=>{const s=F.get("cardConfigs")??[];p.value=new Map(s.map(l=>[ue(),l]))});const n=R(F.get("showRewardMilesType")??"AllPlanRewardMiles");function i(s){F.set("showRewardMilesType",s),n.value=s}const c=R(F.get("commonPaymentMethods")??["信用卡","Apple Pay","Line Pay","街口支付"]);function v([...s]){s=[...new Set(s)],F.set("commonPaymentMethods",s),c.value=s}const p=R(new Map),y=Z(()=>(p.value.size===0?gt:[...p.value.values()]).map(l=>dt(l)));function A(s,l){p.value.set(s,l),F.set("cardConfigs",[...p.value.values()])}function r(s){p.value.delete(s),F.set("cardConfigs",[...p.value.values()])}const _=Z(()=>Te(ke(y.value.flatMap(s=>s.storeList)),"asc")),S=R(F.get("conditionTypes")??[]);function t([...s]){S.value=s,F.set("conditionTypes",s)}const u=R(F.get("aliasType")??"default");function D(s){Ie.includes(s)&&(u.value=s,F.set("aliasType",s))}const B=R(new Map(F.get("customAliases")??[]));function I(s,l){l.length===0?B.value.delete(s):B.value.set(s,l),F.set("customAliases",[...B.value])}function J(s){B.value=new Map(s),F.set("customAliases",s)}const m=Z(()=>{const s=[];["default","additional"].includes(u.value)&&s.push(...Ue),["additional","custom"].includes(u.value)&&s.push(...B.value);const l=new Map;for(const[g,L]of s){const E=l.get(g)??new Set;for(const $ of L)E.add($);l.set(g,E)}return l});return{dialog:H(o),openDialog:e,closeDialog:a,showRewardMilesType:H(n),updateShowRewardMilesType:i,commonPaymentMethods:H(c),updateCommonPaymentMethods:v,cardConfigs:H(p),cards:y,updateCardConfig:A,deleteCardConfig:r,storeList:H(_),conditionTypes:H(S),updateConditionTypes:t,aliasType:H(u),storeAliases:m,updateAliasType:D,customAliases:H(B),updateCustomAliases:I,updateAllCustomAliases:J}}),Pt={class:"flex-col gap-24px my-16px"},ft={class:"flex-center gap-8px"},ht={class:"flex mx-16px"},wt=te({__name:"CommonSettings",setup(o){const e=le(),{showRewardMilesType:a,commonPaymentMethods:n,conditionTypes:i}=se(e);return(c,v)=>{const p=P("v-label"),y=P("v-radio"),A=P("v-radio-group"),r=P("v-select"),_=P("v-switch");return f(),b("div",Pt,[h("div",ft,[d(p,{text:"回饋顯示"}),d(A,{"model-value":k(a),"hide-details":"",inline:"","onUpdate:modelValue":v[0]||(v[0]=S=>S!==null&&k(e).updateShowRewardMilesType(S))},{default:w(()=>[d(y,{density:"compact",label:"全部方案",value:"AllPlanRewardMiles"}),d(y,{density:"compact",label:"當前方案",value:"CurrentPlanRewardMiles"})]),_:1},8,["model-value"])]),h("div",null,[d(r,{"model-value":k(n),items:k(Te)(k(lt),"asc"),label:"使用中的付款方式",multiple:"","hide-details":"","onUpdate:modelValue":v[1]||(v[1]=S=>S!==null&&k(e).updateCommonPaymentMethods(S))},null,8,["model-value","items"])]),h("div",null,[d(p,{text:"其他設定"}),h("div",ht,[d(_,{"model-value":k(i),label:"生日中",value:"Birthday","hide-details":"",color:"blue","onUpdate:modelValue":v[2]||(v[2]=S=>S!==null&&k(e).updateConditionTypes(S))},null,8,["model-value"])])])])}}}),At={class:"relative"},St={key:0,class:"text-red ml-2px"},we=te({__name:"TextFiled",props:Oe({required:{type:Boolean,default:!1},label:{},isUrl:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const e=De(o,"modelValue"),a=Z(()=>{const i=[];return o.required&&i.push(c=>!!c||"此欄位為必填"),o.isUrl&&i.push(c=>!!(c===null||c===""||c.startsWith("https://"))||"請填寫正確的網址 (需為 https:// 開頭)"),i});function n(i){i=(i==null?void 0:i.trim())??null,e.value=pe(i)?i:null}return(i,c)=>{const v=P("v-text-field");return f(),N(v,{clearable:"",rules:a.value,"model-value":e.value,"onUpdate:modelValue":n},{label:w(()=>[h("p",At,[z(M(i.label)+" ",1),i.required?(f(),b("span",St,"*")):j("",!0)])]),_:1},8,["rules","model-value"])}}});function ee(o){if(o===null||typeof o!="object")return o;if(Array.isArray(o))return o.map(a=>ee(a));if(o instanceof Map)return new Map(Array.from(o.entries()).map(([a,n])=>[ee(a),ee(n)]));if(o instanceof Set)return new Set(Array.from(o.values()).map(a=>ee(a)));if(o instanceof Date)return new Date(o.getTime());if(o instanceof RegExp)return new RegExp(o.source,o.flags);const e={};return Object.keys(o).forEach(a=>{e[a]=ee(o[a])}),e}const xt={class:"flex-col gap-4px h-full overflow-hidden"},kt={class:"flex justify-end"},bt={class:"flex-1 gap-8px flex-col overflow-y-auto py-8px"},Ct={key:0,class:"flex-col gap-2 m-16px"},Rt={class:"flex-col gap-4px m-8px"},Tt={class:"flex-col"},Lt={class:"text-1rem"},Bt={class:"text-0.75rem"},Mt=te({__name:"CreditCardManagement",setup(o){const e=le(),{cardConfigs:a}=se(e),n=R(null),i=R(!1),c=R([]);function v(){for(const A of c.value)e.updateCardConfig(ue(),A),i.value=!1}function p(){n.value!==null&&(e.updateCardConfig(n.value.id,n.value.config),n.value=null)}function y(){n.value!==null&&(e.deleteCardConfig(n.value.id),n.value=null)}return(A,r)=>{const _=P("v-btn"),S=P("v-card"),t=P("v-toolbar-title"),u=P("v-spacer"),D=P("v-toolbar-items"),B=P("v-toolbar"),I=P("v-dialog"),J=P("v-checkbox");return f(),b(O,null,[h("div",xt,[h("div",kt,[d(_,{text:"匯入",onClick:r[0]||(r[0]=()=>{c.value=[],i.value=!0})})]),h("div",bt,[(f(!0),b(O,null,W(k(a).entries(),([m,s],l)=>(f(),N(S,{key:l,density:"compact",class:"mx-auto w-full flex-shrink-0",variant:"outlined",title:s.name,text:s.description??"",onClick:()=>n.value={id:m,config:k(ee)(s)}},null,8,["title","text","onClick"]))),128))])]),d(I,{"model-value":!!n.value,fullscreen:"","onUpdate:modelValue":r[6]||(r[6]=m=>n.value=null)},{default:w(()=>[d(S,{class:"reward-detail-dialog"},{default:w(()=>[d(B,null,{default:w(()=>[d(_,{icon:"mdi-close",onClick:r[1]||(r[1]=m=>n.value=null)}),d(t,null,{default:w(()=>r[10]||(r[10]=[z("編輯卡片")])),_:1}),d(u),d(D,null,{default:w(()=>[d(_,{text:"Save",onClick:p})]),_:1})]),_:1}),n.value?(f(),b("div",Ct,[d(we,{modelValue:n.value.config.name,"onUpdate:modelValue":r[2]||(r[2]=m=>n.value.config.name=m),label:"卡片名稱",required:""},null,8,["modelValue"]),d(we,{modelValue:n.value.config.description,"onUpdate:modelValue":r[3]||(r[3]=m=>n.value.config.description=m),label:"卡片描述"},null,8,["modelValue"]),d(we,{modelValue:n.value.config.cardUrl,"onUpdate:modelValue":r[4]||(r[4]=m=>n.value.config.cardUrl=m),"is-url":"",label:"信用卡網頁"},null,8,["modelValue"]),h("div",null,[d(_,{text:"Delete",onClick:r[5]||(r[5]=m=>k(e).openDialog({text:"確定要刪除嗎？",events:[{text:"cancel"},{text:"delete",event:y}]}))})])])):j("",!0)]),_:1})]),_:1},8,["model-value"]),d(I,{modelValue:i.value,"onUpdate:modelValue":r[9]||(r[9]=m=>i.value=m),fullscreen:""},{default:w(()=>[d(S,{class:"reward-detail-dialog"},{default:w(()=>[d(B,null,{default:w(()=>[d(_,{icon:"mdi-close",onClick:r[7]||(r[7]=m=>i.value=!1)}),d(t,null,{default:w(()=>r[11]||(r[11]=[z("請選擇卡片")])),_:1}),d(u),d(D,null,{default:w(()=>[d(_,{text:"匯入",onClick:v})]),_:1})]),_:1}),h("div",Rt,[(f(!0),b(O,null,W(k(vt),(m,s)=>(f(),N(J,{key:s,modelValue:c.value,"onUpdate:modelValue":r[8]||(r[8]=l=>c.value=l),value:m,"hide-details":"",density:"comfortable"},{label:w(()=>[h("div",Tt,[h("p",Lt,M(m.name),1),h("p",Bt,M(m.description),1)])]),_:2},1032,["modelValue","value"]))),128))])]),_:1})]),_:1},8,["modelValue"])],64)}}}),Et={class:"gap-8px h-full flex-col"},Ut={class:"flex items-center flex-wrap gap-x-8px"},It={class:"gap-8px flex-center"},$t={ref:"rewardCardList",class:"flex-col gap-4px flex-grow-1 overflow-y-auto"},Vt={class:"flex items-center justify-between"},Nt={class:"flex gap-4px items-end"},Ot={class:"text-12px opacity-50 p-4px"},Dt={key:0,class:"fa-solid fa-circle-check"},Ft={class:"flex-col gap-8px"},Jt={class:"text-0.75rem"},Kt={class:"text-wrap"},Gt={class:"flex-col"},jt={class:"flex justify-between"},zt=["href"],Wt={key:0},Xt={key:1},Ht="其他店家",Yt=te({__name:"SearchReward",setup(o){const e=ne(0),a=ne(2),n=Le(0),{showRewardMilesType:i,commonPaymentMethods:c,cards:v,conditionTypes:p,storeAliases:y,storeList:A}=se(le()),r=R(0),_=R(null),S=R("Domestic"),t=R([]),u=Ae("rewardCardList"),D=Ae("storeAutoComplete"),B=Z(()=>{const l=A.value.map(g=>({store:g,aliases:[...y.value.get(g)??[]]}));return[{store:Ht},...l]});function I(l,g,L){return g=g.toLowerCase(),[l,...(L==null?void 0:L.raw.aliases)??[]].map($=>$.toLowerCase()).some($=>$.includes(g))}const J=Z(()=>{var L;const l={amount:r.value,acceptedPayments:t.value,transactionAttributesType:S.value,currentConditions:[...p.value]};pe(_.value)&&(l.transactionStore=_.value);const g=[];for(const E of v.value){const $=E.getRewardInfos(l,i.value==="CurrentPlanRewardMiles"?{onlyCurrentExchangeStrategy:!0,onlyCurrentPlan:!0}:{});for(const T of $){const V={cardName:E.name,planName:T.planName,rewardName:T.rewardName,miles:T.miles,payments:T.payments,airLinesCode:T.airlineCode,isSelectedPlan:i.value==="AllPlanRewardMiles"&&T.planId===E.selectedPlanId,calculateDetail:s(T.rewardStrategy,T.pointExchangeStrategy),description:T.rewardStrategy===null?null:`${T.rewardStrategy.description}，${T.pointExchangeStrategy.description}`,cardUrl:E.cardUrl,cardDescription:E.description,pointExchangeName:T.pointExchangeName};g.push(V)}}return(L=u.value)==null||L.scrollTo({top:0,behavior:"smooth"}),Re(Re(g,"isSelectedPlan","desc"),"miles","desc")}),m=R(null);function s(l,g){const{pointsPerMile:L,milesPerUnit:E,airlineCode:$}=g,T="回饋計算:";switch(l==null?void 0:l.type){case"RoundedPercentageReward":case"TruncatedPercentageReward":{const V=l.type==="RoundedPercentageReward"?e:n;let X=0;return[T,...l.pointBackRates.map(({rate:Y,limit:q})=>{const Q=Math.min(V(r.value*Y/100),q??1/0);X+=Q;const x=q!==void 0?` (limit ${q})`:"";return`${r.value} * ${Y}% = ${Q}${x}`}),`總計 ${X} points`,`${X} / ${L} * ${E} = ${g.calculateMiles(X)} ${$}`]}case"AccumulatedPointsReward":{const V=a(r.value/l.spendingPerPoint);return[T,`${r.value} / ${l.spendingPerPoint} = ${V} points`,`${V} / ${L} * ${E} = ${g.calculateMiles(V)} ${$}`]}case"FixedRatePointsReward":{const V=n(r.value/l.spendingPerPoint);return[T,`${r.value} / ${l.spendingPerPoint} = ${V} points (小數省略)`,`${V} / ${L} * ${E} = ${g.calculateMiles(V)} ${$}`]}default:return[]}}return(l,g)=>{const L=P("v-text-field"),E=P("v-autocomplete"),$=P("v-label"),T=P("v-checkbox"),V=P("v-radio"),X=P("v-radio-group"),Y=P("v-card"),q=P("v-btn"),Q=P("v-dialog");return f(),b(O,null,[h("div",Et,[d(L,{"model-value":r.value,class:"flex-grow-0",density:"comfortable","hide-details":"",label:"交易金額",inputmode:"decimal",clearable:r.value!==0,"onUpdate:modelValue":g[0]||(g[0]=x=>r.value=isNaN(parseFloat(x))?0:parseFloat(x))},null,8,["model-value","clearable"]),d(E,{ref:"storeAutoComplete",modelValue:_.value,"onUpdate:modelValue":g[1]||(g[1]=x=>_.value=x),"custom-filter":I,class:"flex-grow-0",density:"comfortable","hide-details":"","item-value":"store","item-title":"store",label:"消費店家",items:B.value,clearable:k(pe)(_.value),placeholder:"全部店家","onUpdate:menu":g[2]||(g[2]=x=>{var K;return!x&&((K=k(D))==null?void 0:K.blur())})},null,8,["modelValue","items","clearable"]),h("div",null,[d($,{text:"支援的付款方式"}),h("div",Ut,[(f(!0),b(O,null,W(k(c),(x,K)=>(f(),N(T,{key:K,modelValue:t.value,"onUpdate:modelValue":g[3]||(g[3]=ye=>t.value=ye),density:"compact",value:x,"hide-details":"",label:x},null,8,["modelValue","value","label"]))),128))])]),h("div",It,[d($,{text:"交易類型"}),d(X,{modelValue:S.value,"onUpdate:modelValue":g[4]||(g[4]=x=>S.value=x),"hide-details":"",inline:""},{default:w(()=>[d(V,{density:"compact",label:"國內交易",value:"Domestic"}),d(V,{density:"compact",label:"國外交易",value:"Foreign"})]),_:1},8,["modelValue"])]),h("div",$t,[(f(!0),b(O,null,W(J.value,(x,K)=>(f(),N(Y,{key:K,density:"compact",class:"mx-auto w-full flex-shrink-0",variant:"outlined",onClick:()=>m.value=x},{title:w(()=>[h("div",Vt,[h("div",Nt,[z(M(x.miles)+" ",1),h("p",Ot,M(x.airLinesCode),1)]),x.isSelectedPlan?(f(),b("i",Dt)):j("",!0)])]),text:w(()=>[h("div",Ft,[h("p",Jt,M(`${x.cardName} ${x.planName??""} ${x.rewardName??""}`)+" "+M(x.payments.length===0?"":` (支付方式: ${x.payments.join(", ")})`),1)])]),_:2},1032,["onClick"]))),128))],512)]),d(Q,{"model-value":!!m.value,"onUpdate:modelValue":g[6]||(g[6]=x=>m.value=null)},{default:w(()=>[m.value?(f(),N(Y,{key:0,class:"mx-auto reward-detail-dialog","min-width":"100%",title:`${m.value.cardName} ${m.value.planName??""} ${m.value.rewardName??""}`},{subtitle:w(()=>[h("p",Kt,M(m.value.description??""),1)]),text:w(()=>[h("div",Gt,[h("p",jt,[g[7]||(g[7]=z(" 卡片說明： ")),m.value.cardUrl!==null?(f(),b("a",{key:0,target:"_blank",class:"underline",href:m.value.cardUrl}," 網站 ",8,zt)):j("",!0)]),m.value.cardDescription!==""||m.value.cardDescription!==null?(f(),b("p",Wt,M(m.value.cardDescription),1)):j("",!0),m.value.pointExchangeName!==""?(f(),b("p",Xt,M(m.value.pointExchangeName),1)):j("",!0),g[8]||(g[8]=h("br",null,null,-1)),h("p",null,"消費金額: "+M(r.value),1),h("p",null,"哩程預估: "+M(m.value.miles)+" "+M(m.value.airLinesCode),1),g[9]||(g[9]=h("br",null,null,-1)),(f(!0),b(O,null,W(m.value.calculateDetail,(x,K)=>(f(),b("p",{key:K},M(x),1))),128))])]),actions:w(()=>[d(q,{class:"ms-auto",text:"Close",onClick:g[5]||(g[5]=x=>m.value=null)})]),_:1},8,["title"])):j("",!0)]),_:1},8,["model-value"])],64)}}}),qt=Ye(Yt,[["__scopeId","data-v-86bb83ce"]]),Zt={class:"flex-col h-full overflow-hidden gap-8px"},Qt={class:"flex-shrink-0 flex-col gap-8px"},ea={key:0,class:"flex justify-between items-center"},ta={class:"flex gap-8px"},aa={key:0,class:"gap-4px flex-col flex-grow-1 overflow-y-auto"},na={class:"text-1rem"},sa={class:"text-0.8rem"},la={key:1,class:"flex-grow-1"},oa={class:"flex-col gap-24px m-8px"},ra={class:"flex-col gap-4px"},ia=te({__name:"StoreAliasManagement",setup(o){const e=le(),{aliasType:a,customAliases:n,storeAliases:i}=se(e),c=Ae("storeList"),v={default:"系統預設",additional:"預設+自定義",custom:"自定義"},p=R(!0),y=R(!1),A=R(!0),r=R("[]"),_=R(null),S=Z(()=>{let s;return a.value==="default"?s=Ue:a.value==="additional"?s=[...i.value].map(([l,g])=>[l,[...g]]):s=[...n.value],s.map(([l,g])=>({title:l,aliases:[...g]}))});Ce(()=>{var s;return(s=_.value)==null?void 0:s.title},s=>{if(s==null||_.value===null)return;const l=[...n.value.get(s)??[]];l[l.length-1]!==""&&l.push(""),_.value.aliases=l}),Ce(p,J),Fe(()=>{J(),y.value=!1,A.value=!0,p.value=!0});function t(s,l){if(_.value===null)return;let g=_.value.aliases;g[l]=s,g[g.length-1]!==""&&g.push("")}function u(s){if(a.value!=="default")if(s===null)_.value={title:null,aliases:[]};else{const l=[...n.value.get(s)??[]];l[l.length-1]!==""&&l.push(""),_.value={title:s,aliases:l}}}function D(){const{title:s,aliases:l}=_.value??{};s==null||l===void 0||(e.updateCustomAliases(s,[...new Set(l)].filter(pe)),_.value=null)}function B(s){if(s=s.trim(),r.value=s,y.value=!0,s===""){A.value=!0;return}try{const l=JSON.parse(s);A.value=xe(l)}catch(l){console.error(l),A.value=!1}}function I(){let s;if(p.value)s=!0;else{r.value===""&&(r.value="[]");try{const l=JSON.parse(r.value);xe(l)?(e.updateAllCustomAliases(l),s=!0):s=!1}catch(l){console.error(l),s=!1}}s?(alert("儲存成功"),y.value=!1):alert(`儲存失敗${p.value?"":"，JSON 不符合規則"}`)}function J(){r.value=JSON.stringify([...n.value],null,2)}function m(s){y.value||(s==="default"&&(p.value=!0),e.updateAliasType(s))}return(s,l)=>{const g=P("v-label"),L=P("v-btn"),E=P("v-btn-toggle"),$=P("v-switch"),T=P("v-card"),V=P("v-textarea"),X=P("v-toolbar-title"),Y=P("v-spacer"),q=P("v-toolbar-items"),Q=P("v-toolbar"),x=P("v-autocomplete"),K=P("v-text-field"),ye=P("v-dialog");return f(),b(O,null,[h("div",Zt,[h("div",Qt,[d(g,{text:"別名設定"}),d(E,{"model-value":k(a),rounded:"0",group:"",class:"w-full flex justify-center",disabled:y.value,"onUpdate:modelValue":m},{default:w(()=>[(f(!0),b(O,null,W(k(Ie),(U,G)=>(f(),N(L,{key:G,class:"flex-1",value:U},{default:w(()=>[z(M(v[U]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["model-value","disabled"]),k(a)!=="default"?(f(),b("div",ea,[h("div",ta,[p.value?(f(),N(L,{key:0,onClick:l[0]||(l[0]=U=>u(null))},{default:w(()=>l[6]||(l[6]=[z(" Add ")])),_:1})):(f(),N(L,{key:1,onClick:I},{default:w(()=>l[7]||(l[7]=[z(" Save ")])),_:1}))]),d($,{modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=U=>p.value=U),disabled:y.value,"hide-details":"",label:"圖示"},null,8,["modelValue","disabled"])])):j("",!0)]),p.value?(f(),b("div",aa,[(f(!0),b(O,null,W(S.value,(U,G)=>(f(),N(T,{key:G,density:"compact",class:"mx-auto w-full flex-shrink-0",variant:"outlined",onClick:ae=>u(U.title)},{text:w(()=>[h("p",na,M(U.title),1),h("p",sa,M(U.aliases.join(", ")),1)]),_:2},1032,["onClick"]))),128))])):(f(),b("div",la,[d(V,{"model-value":r.value,clearable:r.value!=="","auto-grow":"",disabled:k(a)==="default","max-rows":15,messages:y.value?"上方儲存完成後才能執行其他動作，離開這頁不會存檔":"","error-messages":A.value?"":"json 無效",label:"自定義別名設定檔","onUpdate:modelValue":B},null,8,["model-value","clearable","disabled","messages","error-messages"])]))]),d(ye,{"model-value":!!_.value,fullscreen:"","onUpdate:modelValue":l[5]||(l[5]=U=>_.value=null)},{default:w(()=>[_.value?(f(),N(T,{key:0,class:"reward-detail-dialog"},{default:w(()=>[d(Q,null,{default:w(()=>[d(L,{icon:"mdi-close",onClick:l[2]||(l[2]=U=>_.value=null)}),d(X,null,{default:w(()=>l[8]||(l[8]=[z("編輯商店別名")])),_:1}),d(Y),d(q,null,{default:w(()=>[d(L,{text:"Save",variant:"text",onClick:D})]),_:1})]),_:1}),h("div",oa,[d(x,{ref:"storeList",modelValue:_.value.title,"onUpdate:modelValue":l[3]||(l[3]=U=>_.value.title=U),class:"flex-grow-0","hide-details":"",label:"目標店家",items:k(e).storeList,placeholder:"選擇店家","onUpdate:menu":l[4]||(l[4]=U=>{var G;return!U&&((G=k(c))==null?void 0:G.blur())})},null,8,["modelValue","items"]),h("div",ra,[d(g,{text:"自定義別名列表"}),(f(!0),b(O,null,W(_.value.aliases,(U,G)=>(f(),N(K,{key:G,"hide-details":"",clearable:"","model-value":U,"onUpdate:modelValue":ae=>t(ae,G),"onClick:clear":()=>{var ae;return(ae=_.value)==null?void 0:ae.aliases.splice(G,1)}},null,8,["model-value","onUpdate:modelValue","onClick:clear"]))),128))])])]),_:1})):j("",!0)]),_:1},8,["model-value"])],64)}}}),da={style:{height:"calc(100dvh - 56px)"},class:"overflow-hidden mt-56px p-8px"},ca=te({__name:"App",setup(o){const e=le(),{dialog:a}=se(e),n={查詢回饋:qt,信用卡管理:Mt,商家別名:ia,喜好設定:wt},i=Object.keys(n),c=R(!1),v=R(i[0]);return(p,y)=>{const A=P("v-app-bar-nav-icon"),r=P("v-app-bar-title"),_=P("v-app-bar"),S=P("v-list-item"),t=P("v-divider"),u=P("v-navigation-drawer"),D=P("v-app"),B=P("v-btn"),I=P("v-card"),J=P("v-dialog");return f(),b(O,null,[d(D,null,{default:w(()=>[d(_,{density:"comfortable",elevation:2},{prepend:w(()=>[d(A,{onClick:y[0]||(y[0]=m=>c.value=!c.value)},{default:w(()=>y[2]||(y[2]=[h("i",{class:"fa-solid fa-bars"},null,-1)])),_:1}),d(r,null,{default:w(()=>[z(M(v.value),1)]),_:1})]),_:1}),d(u,{modelValue:c.value,"onUpdate:modelValue":y[1]||(y[1]=m=>c.value=m)},{default:w(()=>[(f(!0),b(O,null,W(k(i),(m,s)=>(f(),b(O,{key:s},[d(S,{title:m,class:Je(["h-48px",{"text-emphasis":v.value===m}]),onClick:()=>{v.value=m,c.value=!1}},null,8,["title","class","onClick"]),d(t)],64))),128))]),_:1},8,["modelValue"]),h("main",da,[(f(),N(Ge,null,[(f(),N(Ke(n[v.value])))],1024))])]),_:1}),d(J,{"model-value":!!k(a),"onUpdate:modelValue":k(e).closeDialog},{default:w(()=>[k(a)!==null?(f(),N(I,{key:0,class:"mx-auto","min-width":"100%",text:k(a).text},{actions:w(()=>[(f(!0),b(O,null,W(k(a).events,(m,s)=>(f(),N(B,{key:s,text:m.text,onClick:async()=>{"event"in m&&await m.event(),k(e).closeDialog()}},null,8,["text","onClick"]))),128))]),_:1},8,["text"])):j("",!0)]),_:1},8,["model-value","onUpdate:modelValue"])],64)}}}),be=je(ca);be.use(He);be.use(We());be.mount("#app");
//# sourceMappingURL=bestMileageCards-gQyqcKzZ.js.map
