var Ne=Object.defineProperty;var Fe=(s,t,a)=>t in s?Ne(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var U=(s,t,a)=>Fe(s,typeof t!="symbol"?t+"":t,a);import{b as M,o as De,c as Q,f as Z,d as ne,B as P,g as v,j as b,k as g,x as c,C as _,u as C,E as Je,G as Ke,v as J,D as j,t as I,y as W,F as G,l as X,z as Ge,e as xe,w as be,H as je,m as Re,I as ze,K as We,A as Xe}from"../index-TcB4GXLN.js";import{d as He,s as se,c as Ye}from"../pinia-Bsc-ARde.js";import{C as qe,v as Ze}from"../StorageManager-D25SzE57.js";import{a as Le,b as Te}from"../sorts-BPW8KRTv.js";import{f as Be,r as oe,b as Se,g as E,a as ye}from"../index-f1g9dClV.js";import{_ as Ue}from"../_plugin-vue_export-helper-DlAUqK2U.js";const Me=Be(0),Qe=oe(0),Ae=oe(2);class ge{constructor({type:t,name:a}){U(this,"_name");U(this,"_type");this._type=t,this._name=a}get name(){return this._name}get type(){return this._type}calculateRangePointsCost(t,a){const o=[];for(let p=t;p<=a;p++){const m=Ae(p/this.calculatePoints(p));isNaN(m)||m===1/0||m===-1/0||o.push(m)}o.sort((p,m)=>p-m);const l=o[o.length-1],r=o[0];if(l===void 0||r===void 0)throw new Error("cannot be calculated");const h=o.reduce((p,m)=>p+m,0)/o.length;return{max:l,min:r,average:Ae(h)}}}class et extends ge{constructor({pointBackRates:a,...o}){super(o);U(this,"_pointBackRates");this._pointBackRates=a}get _maxRete(){return this._pointBackRates.reduce((a,{rate:o})=>a+o,0)}get pointBackRates(){return this._pointBackRates}get description(){return`消費${this._pointBackRates.length>1?"最高":""}${this._maxRete.toString()}%回饋點數(四捨五入)`}calculatePoints(a){let o=0;for(const{rate:l,limit:r=1/0}of this._pointBackRates)o+=Math.min(Qe(a*(l/100)),r);return o}toJSON(){return{name:this._name,type:this._type,pointBackRates:this._pointBackRates}}}class tt extends ge{constructor({pointBackRates:a,...o}){super(o);U(this,"_pointBackRates");this._pointBackRates=a}get _maxRete(){return this._pointBackRates.reduce((a,{rate:o})=>a+o,0)}get pointBackRates(){return this._pointBackRates}get description(){return`消費${this._pointBackRates.length>1?"最高":""}${this._maxRete.toString()}%回饋點數(無條件捨去)`}calculatePoints(a){let o=0;for(const{rate:l,limit:r=1/0}of this._pointBackRates)o+=Math.min(Me(a*(l/100)),r);return o}toJSON(){return{name:this._name,type:this._type,pointBackRates:this._pointBackRates}}}class at extends ge{constructor({spendingPerPoint:a,...o}){super({...o});U(this,"_spendingPerPoint");this._spendingPerPoint=a}get spendingPerPoint(){return this._spendingPerPoint}get description(){return`每消費${this._spendingPerPoint.toString()}元累積1點 (小數會累計)`}calculatePoints(a){return Ae(a/this._spendingPerPoint)}toJSON(){return{name:this._name,type:this._type,spendingPerPoint:this._spendingPerPoint}}}class nt extends ge{constructor({spendingPerPoint:a,...o}){super({...o});U(this,"_spendingPerPoint");this._spendingPerPoint=a}get spendingPerPoint(){return this._spendingPerPoint}get description(){return`每消費${this._spendingPerPoint.toString()}元累積1點 (小數不累計)`}calculatePoints(a){return Me(a/this._spendingPerPoint)}toJSON(){return{name:this._name,type:this._type,spendingPerPoint:this._spendingPerPoint}}}const lt={RoundedPercentageReward:et,TruncatedPercentageReward:tt,AccumulatedPointsReward:at,FixedRatePointsReward:nt};function ot(s){return new lt[s.type](s)}class st{constructor(t,a,o){U(this,"_name");U(this,"_rewards");U(this,"_condition");if(this._name=t,this._condition=a,o.length===0)throw new Error(`Plan "${t??"unknown"}" must have at least one reward rule.`);this._rewards=o}get name(){return this._name}get storeList(){return Se(this._rewards.flatMap(t=>[...t.stores,...t.storeBlackList]))}checkPlanIsVisible(t){return this._condition===null||!!(t!=null&&t.includes(this._condition))}getApplicableReward({transactionStore:t=null,acceptedPayments:a=[],transactionAttributesType:o,currentConditions:l=null}){return this._condition!==null&&!(l!=null&&l.includes(this._condition))?null:this._rewards.find(({stores:r,payments:h,transactionType:p,paymentBlackList:m,storeBlackList:A,condition:S})=>{const d=t===null||r.size===0||r.has(t),T=t===null||A.size===0||!A.has(t),f=a.length===0||h.size===0||a.some(K=>h.has(K)),O=a.length===0||m.size===0||a.some(K=>!m.has(K)),e=p===null||o===p,y=S===null||!!(l!=null&&l.includes(S));return d&&T&&f&&O&&e&&y})??null}getRewardMiles({transactionStore:t,acceptedPayments:a,amount:o,transactionAttributesType:l,currentConditions:r}){const h=this.getApplicableReward({acceptedPayments:a,transactionStore:t,transactionAttributesType:l,currentConditions:r});if(h===null)return null;const p=a===void 0?[...h.payments.values()]:a.filter(m=>h.payments.has(m));return{rewardName:h.rewardStrategy.name,rewardPoints:h.rewardStrategy.calculatePoints(o),payments:p.filter(m=>!h.paymentBlackList.has(m)),rewardStrategy:h.rewardStrategy}}toJSON(){return{name:this._name,condition:this._condition,rewards:this._rewards.map(({rewardStrategy:t,stores:a,payments:o,transactionType:l,paymentBlackList:r,storeBlackList:h,condition:p})=>({rewardStrategy:t.toJSON(),stores:[...a],storeBlackList:[...h],payments:[...o],paymentBlackList:[...r],transactionType:l,condition:p}))}}}const it=["信用卡","Apple Pay","Samsung Pay","Google Pay","Line Pay","Fitbit Pay","Garmin Pay","Hami Pay","街口支付","全盈+PAY","全支付","Pi錢包","橘子支付","歐付寶","icash pay","OPEN錢包","My FamiPay","悠遊付","ezPay","GOMAJI Pay","friday wallet","PayPal","PX Pay","中油Pay","台灣Pay","支付寶"];class rt{constructor({name:t,description:a,plans:o,storeBlackList:l,paymentBlackList:r,cardUrl:h,updateAt:p,pointExchanges:m,selectedPlanId:A,selectedPointExchangeId:S}){U(this,"_selectedPlanId");U(this,"_selectedPointExchangeId");U(this,"_name");U(this,"_description");U(this,"_plans");U(this,"_cardUrl");U(this,"_storeBlackList");U(this,"_paymentBlackList");U(this,"_updateAt");U(this,"_pointExchanges");this._name=t,this._description=a,this._plans=o,this._cardUrl=h,this._storeBlackList=l,this._paymentBlackList=r,this._updateAt=p,this._pointExchanges=m;const d=A??this._plans.keys().next().value??null;if(d===null)throw new Error(`this plan id ${d} not found`);this._selectedPlanId=d;const T=S??this._pointExchanges.keys().next().value??null;if(T===null)throw new Error(`this point exchange id ${T} not found`);this._selectedPointExchangeId=T}get name(){return this._name}get description(){return this._description}get selectedPlanId(){return this._selectedPlanId}get selectedPlan(){return this._getPlan(this._selectedPlanId)}get selectedPointExchangeId(){return this._selectedPointExchangeId}get selectedPointExchange(){return this._getPointExchangeStrategy(this._selectedPointExchangeId)}get selectablePlan(){return[...this._plans.entries()].map(([t,{name:a}])=>({id:t,name:a}))}get selectablePointExchange(){return[...this._pointExchanges.entries()].map(([t,{name:a,description:o}])=>({id:t,name:a,description:o}))}get storeList(){return Se([...[...this._plans.values()].flatMap(t=>t.storeList),...this._storeBlackList])}get cardUrl(){return this._cardUrl}_getPlan(t){const a=this._plans.get(t);if(a===void 0)throw new Error(`plan id ${t} not found. Available plans: ${[...this._plans.keys()].join(", ")}`);return a}_getPointExchangeStrategy(t){const a=this._pointExchanges.get(t);if(a===void 0)throw new Error(`pointExchangeStrategy id ${t} not found. Available pointExchanges: ${[...this._plans.keys()].join(", ")}`);return a}_rewardMilesWithPlan(t,a,o){var S;const l=this._getPlan(t),r=this._getPointExchangeStrategy(a),h={planId:t,planName:l.name,rewardName:null,rewardPoints:0,payments:[],rewardStrategy:null,pointExchangeStrategy:r,pointExchangeName:r.name,airlineCode:r.airlineCode,miles:0},p=o.transactionStore!==void 0&&this._storeBlackList.has(o.transactionStore),m=(S=o.acceptedPayments)==null?void 0:S.some(d=>this._paymentBlackList.has(d));if(p||m)return h;const A=l.getRewardMiles(o);return A===null?h:{planId:t,planName:l.name,pointExchangeStrategy:r,pointExchangeName:r.name,miles:r.calculateMiles(A.rewardPoints),airlineCode:r.airlineCode,...A}}getRewardInfos(t,{onlyCurrentPlan:a=!1,onlyCurrentExchangeStrategy:o=!1}={}){const l=a?[[this._selectedPlanId,this.selectedPlan]]:[...this._plans.entries()],r=o?[this._selectedPointExchangeId]:[...this._pointExchanges.keys()],h=[];for(const[p,m]of l)if(m.checkPlanIsVisible(t.currentConditions??null))for(const S of r){const d=this._rewardMilesWithPlan(p,S,t);h.push(d)}return h}toJSON(){return{name:this._name,description:this._description,cardUrl:this._cardUrl,storeBlackList:[...this._storeBlackList],paymentBlackList:[...this._paymentBlackList],selectedPlanId:this._selectedPlanId,plans:[...this._plans].map(([t,a])=>({id:t,config:a.toJSON()})),updateAt:this._updateAt.toISOString(),selectedPointExchangeId:this._selectedPointExchangeId,pointExchanges:[...this._pointExchanges].map(([t,a])=>({id:t,config:a.toJSON()}))}}}const dt=oe(2);class ct{constructor({name:t,airlineCode:a,pointsPerMile:o,milesPerUnit:l}){U(this,"_name");U(this,"_airlineCode");U(this,"_pointsPerMile");U(this,"_milesPerUnit");this._name=t,this._airlineCode=a,this._pointsPerMile=o,this._milesPerUnit=l}get name(){return this._name}get description(){return`${this._pointsPerMile}點可以交換${this._milesPerUnit}哩程`}get airlineCode(){return this._airlineCode}get pointsPerMile(){return this._pointsPerMile}get milesPerUnit(){return this._milesPerUnit}calculateMiles(t){return dt(t*this._milesPerUnit/this._pointsPerMile)}toJSON(){return{name:this._name,airlineCode:this._airlineCode,pointsPerMile:this._pointsPerMile,milesPerUnit:this._milesPerUnit}}}function Ee({name:s,description:t,storeBlackList:a,paymentBlackList:o,cardUrl:l,plans:r,updateAt:h,pointExchanges:p,selectedPlanId:m,selectedPointExchangeId:A}){const S=new Map(r.map(({id:d,config:{name:T,condition:f,rewards:O}})=>[d,new st(T,f??null,O.map(({stores:e,payments:y,transactionType:K,rewardStrategy:z,paymentBlackList:L,storeBlackList:i,condition:u})=>({rewardStrategy:ot(z),stores:new Set(e),storeBlackList:new Set(i),payments:new Set(y),paymentBlackList:new Set(L),transactionType:K??null,condition:u??null})))]));return new rt({name:s,description:t,plans:S,storeBlackList:new Set(a),paymentBlackList:new Set(o),cardUrl:l,updateAt:new Date(h),selectedPlanId:m??null,selectedPointExchangeId:A??null,pointExchanges:new Map(p.map(({id:d,config:T})=>[d,new ct(T)]))})}const re=["分期付款"],de=[],ve=["信用卡","Apple Pay","Samsung Pay","Google Pay","Fitbit Pay","Garmin Pay","Hami Pay"];function ce(s){const t={rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:.3}]}};return[{id:E(),config:{name:"集精選",rewards:[{rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:2}]},stores:["家樂福","LOPIA台灣","全聯福利中心","台灣中油-直營","7-ELEVEN","全家便利商店","IKEA"],payments:[...ve,"PX Pay","My FamiPay","OPEN錢包"]},t]}},{id:E(),config:{name:"玩數位",rewards:[{rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:s}]},stores:["App Store","Apple Music","iCloud","Apple TV+","Apple Arcade","Apple One","iTunes","Google Play","Disney+","Netflix","Spotify","KKBOX","YouTube Premium","蝦皮購物","momo購物網","PChome 24h購物(不含儲值及電子票券)","博客來","小樹購","Coupang 酷澎(台灣)","淘寶/天貓"],paymentBlackList:["Line Pay","街口支付"]},{...t,storeBlackList:["全聯福利中心"]}]}},{id:E(),config:{name:"樂饗購",rewards:[{rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:s}]},stores:["遠東SOGO百貨","遠東Garden City","太平洋百貨","新光三越","SKM Park","BELLAVITA","微風廣場","遠東百貨","Big City遠東巨城購物中心","誠品生活","環球購物中心","CITYLINK","統一時代","台北101","ATT 4 FUN","明曜百貨","京站","美麗華","大葉高島屋","比漾廣場","大江國際購物中心","中友百貨","廣三SOGO","Tiger City","勤美誠品綠園道","大魯閣新時代","耐斯廣場","南紡購物中心","夢時代","漢神百貨","漢神巨蛋","MITSUI OUTLET PARK 林口","MITSUI OUTLET PARK 台中港","MITSUI OUTLET PARK 台南","Mitsui Shopping Park LaLaport 台中","義大世界購物廣場","華泰名品城","義享天地","麗寶OUTLET Mall","秀泰生活","台茂購物中心","新月廣場","三創生活","宏匯廣場","高雄棧貳庫/大港倉","NOKE忠泰樂生活","Uber Eats","foodpanda","foodomo","國內餐飲(不含餐券)","麥當勞","康是美","屈臣氏"],payments:ve},{...t,storeBlackList:["全聯福利中心"]}]}},{id:E(),config:{name:"趣旅行",rewards:[{rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:s}]},stores:["海外實體消費","東京迪士尼樂園","東京華納兄弟哈利波特影城","大阪環球影城(USJ)","吉卜力公園","Apple Wallet SUICA","Apple Wallet PASMO","Apple Wallet ICOCA","Uber","Grab","台灣高鐵","yoxi","台灣大車隊","iRent","和運租車","格上租車","中華航空","長榮航空","星宇航空","台灣虎航","國泰航空","樂桃航空","阿聯酋航空","酷航","捷星航空","日本航空","亞洲航空","聯合航空","ANA全日空","新加坡航空","越捷航空","大韓航空","達美航空","土耳其航空","卡達航空","法國航空","國內飯店住宿","星野集團","全球迪士尼飯店","東橫INN","KKday","Agoda","Klook","Airbnb","Hotels.com","Expedia","Booking.com","Trip.com","AsiaYo","ezTravel易遊網","雄獅旅遊","可樂旅遊","東南旅遊","五福旅遊","燦星旅遊","山富旅遊","長汎假期","鳳凰旅行社","Ezfly易飛網","理想旅遊","永利旅行社","三賀旅行社","173WIFI","JetFi mobile","威訊 WaySim","AIRSIM","SIM88"],payments:ve},{...t,storeBlackList:["全聯福利中心"]}]}},{id:E(),config:{name:"來支付",rewards:[{rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:2}]},payments:["Line Pay"]},{...t,storeBlackList:["全聯福利中心"]}]}},{id:E(),config:{name:"慶生月",condition:"Birthday",rewards:[{rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:10}]},stores:["東京迪士尼樂園","大阪環球影城(USJ)","名古屋樂高樂園","紅葉蛋糕官方網站","法朋烘焙甜點坊","興波咖啡 華山旗艦店","海底撈火鍋","輕井澤鍋物","老四川巴蜀麻辣燙","二本松涮涮屋","橋山.壽喜燒","Umai屋馬燒肉","老井極上燒肉","燒肉中山(台中大墩)","藏壽司台灣","貳樓","膳馨民間創作料理","馨苑小料理","雅室牛排 仁愛圓環店","ABV餐飲集團","WAT","臺虎精釀(信義 | 西門 | 臺中 | 啜飲室大安)","BAR Bodega","BAR MED","JiN Her 今鶴","錢櫃KTV","好樂迪KTV","星聚點KTV","享溫馨KTV","Nintendo","巴哈姆特動畫瘋","閃動格子CyberCube"]},{rewardStrategy:{type:"RoundedPercentageReward",name:null,pointBackRates:[{rate:3.5}]},stores:["新光三越","Uber Eats (不含 Uber One)","Agoda","Trip.com","Klook","國內飯店住宿","星野集團","全球迪士尼飯店","東橫INN"]},{...t,storeBlackList:["全聯福利中心"]}]}}]}const ue=[{id:E(),config:{name:"長榮航空哩程",airlineCode:"EVA",pointsPerMile:360,milesPerUnit:1e3}},{id:E(),config:{name:"長榮航空哩程 + 長榮世界卡",airlineCode:"EVA",pointsPerMile:300,milesPerUnit:1e3}}],ut=[{name:"Cube 卡",description:"Cube 卡 (Level 1) 回饋方案",cardUrl:"https://www.cathaybk.com.tw/cathaybk/personal/product/credit-card/cards/cube/",storeBlackList:re,paymentBlackList:de,updateAt:"2024-12-01T00:00:00.000Z",plans:ce(2),pointExchanges:ue},{name:"Cube 卡",description:"Cube 卡 (Level 2) 回饋方案",cardUrl:"https://www.cathaybk.com.tw/cathaybk/personal/product/credit-card/cards/cube/",storeBlackList:re,paymentBlackList:de,updateAt:"2024-12-01T00:00:00.000Z",plans:ce(3),pointExchanges:ue},{name:"Cube 卡",description:"Cube 卡 (Level 3) 回饋方案",cardUrl:"https://www.cathaybk.com.tw/cathaybk/personal/product/credit-card/cards/cube/",storeBlackList:re,paymentBlackList:de,updateAt:"2024-12-01T00:00:00.000Z",plans:ce(3.3),pointExchanges:ue}],pt={name:"Cube 卡",description:"Cube 卡 (Level 2) 回饋方案",cardUrl:"https://www.cathaybk.com.tw/cathaybk/personal/product/credit-card/cards/cube/",storeBlackList:re,paymentBlackList:de,updateAt:"2024-12-01T00:00:00.000Z",plans:ce(3),pointExchanges:ue},pe=["政府稅款","公共事業代扣繳","交通違規罰鍰","分期付款","全聯福利中心","7-ELEVEN","全家便利商店"],me=[],mt=[{name:"星宇世界卡",description:null,cardUrl:"https://www.esunbank.com/zh-tw/personal/credit-card/intro/co-branded-card/starlux-card",storeBlackList:pe,paymentBlackList:me,pointExchanges:[{id:E(),config:{name:"星宇航空哩程",airlineCode:"SJX",pointsPerMile:1,milesPerUnit:1}}],plans:[{id:E(),config:{name:null,rewards:[{rewardStrategy:{type:"FixedRatePointsReward",name:"國外消費 (生日兩倍)",spendingPerPoint:5},transactionType:"Foreign",condition:"Birthday"},{rewardStrategy:{type:"FixedRatePointsReward",name:"國外消費",spendingPerPoint:10},transactionType:"Foreign"},{rewardStrategy:{type:"FixedRatePointsReward",name:"國內消費",spendingPerPoint:20},transactionType:"Domestic"}]}}],updateAt:new Date("2024/12/01 00:00:00").toISOString()},{name:"星宇商務鈦金卡",description:null,cardUrl:"https://www.esunbank.com/zh-tw/personal/credit-card/intro/co-branded-card/starlux-card",storeBlackList:pe,paymentBlackList:me,pointExchanges:[{id:E(),config:{name:"星宇航空哩程",airlineCode:"SJX",pointsPerMile:1,milesPerUnit:1}}],plans:[{id:E(),config:{name:null,rewards:[{rewardStrategy:{type:"FixedRatePointsReward",name:"國外消費",spendingPerPoint:7.5},transactionType:"Foreign",condition:"Birthday"},{rewardStrategy:{type:"FixedRatePointsReward",name:"國外消費",spendingPerPoint:15},transactionType:"Foreign"},{rewardStrategy:{type:"FixedRatePointsReward",name:"國內消費",spendingPerPoint:25},transactionType:"Domestic"}]}}],updateAt:new Date("2024/12/01 00:00:00").toISOString()},{name:"星宇鈦金卡",description:null,cardUrl:"https://www.esunbank.com/zh-tw/personal/credit-card/intro/co-branded-card/starlux-card",storeBlackList:pe,paymentBlackList:me,pointExchanges:[{id:E(),config:{name:"星宇航空哩程",airlineCode:"SJX",pointsPerMile:1,milesPerUnit:1}}],plans:[{id:E(),config:{name:null,rewards:[{rewardStrategy:{type:"FixedRatePointsReward",name:"國外消費",spendingPerPoint:20},transactionType:"Foreign"},{rewardStrategy:{type:"FixedRatePointsReward",name:"國內消費",spendingPerPoint:28},transactionType:"Domestic"}]}}],updateAt:new Date("2024/12/01 00:00:00").toISOString()}],fe=["台灣中油-直營","台灣大車隊","台鐵","台灣高鐵","UBER","Yoxi","LINEGO","新光三越","遠東百貨","遠東SOGO百貨","誠品生活","漢神百貨","微風廣場","微風信義","微風南京","微風南山","微風台北車站","環球購物中心","台北101","華泰名品城","MITSUI OUTLET PARK 林口","MITSUI OUTLET PARK 台中港","MITSUI OUTLET PARK 台南","Big City遠東巨城購物中心","昇恆昌","夢時代購物中心","京站","美麗華","南紡購物中心","秀泰生活","台茂購物中心","Mitsui Shopping Park LaLaport 台中","統領廣場","采盟","Uber Eats","foodpanda","星巴克","EZTABLE","王品瘋美食","摩斯漢堡","foodomo","漢來美食","饗Joy","饗食天堂","果然匯","小福利","饗饗","旭集","開飯","饗泰多","真珠","瓦城","非常泰","大心","1010","時時香","BOBO","乾杯集團","路易莎","中華航空","長榮航空","日本航空","台灣虎航","樂桃航空","酷航","立榮航空","華信航空","Agoda","booking.com","Hotels.com","AsiaYo","Expedia","KKday","Klook","雄獅旅遊","可樂旅遊","東南旅行社","Apple直營店","小米台灣","全國電子","燦坤","迪卡儂","屈臣氏","康是美","IKEA","特力屋","特力和樂","UNIQLO","NET","大樹藥局","丁丁藥妝","momo購物網","蝦皮購物","淘寶網","Coupang酷澎","東森購物","雅虎奇摩購物中心","博客來","玉山Wallet愛心捐款-單筆捐款","玉山Wallet愛心捐款-定期定額","特斯拉","Gogoro電池資費","YouBike 2.0","日本實體店","韓國實體店","泰國實體店","越南實體店","新加坡實體店","中國實體店","香港實體店","澳門實體店","美國實體店","英國實體店","法國實體店","德國實體店","義大利實體店"],_e={rewardStrategy:{type:"TruncatedPercentageReward",name:null,pointBackRates:[{rate:.3},{rate:.7}]}},Ie=[{name:"UniCard 卡",description:null,cardUrl:"https://www.esunbank.com/zh-tw/personal/credit-card/intro/bank-card/unicard",storeBlackList:pe,paymentBlackList:me,pointExchanges:[{id:E(),config:{name:"長榮航空哩程",airlineCode:"EVA",pointsPerMile:200,milesPerUnit:300}}],plans:[{id:E(),config:{name:"任意選 (需要切換店家)",rewards:[{rewardStrategy:{type:"TruncatedPercentageReward",name:null,pointBackRates:[{rate:.3},{rate:.7},{rate:2.5,limit:500}]},stores:fe,payments:["信用卡","Apple Pay","Samsung Pay","Google Pay"]},{rewardStrategy:{type:"TruncatedPercentageReward",name:null,pointBackRates:[{rate:.3},{rate:.7},{rate:2.5,limit:500}]},payments:["Line Pay","街口支付","悠遊付","橘子支付","icash pay"]},_e]}},{id:E(),config:{name:"簡單選",rewards:[{rewardStrategy:{type:"TruncatedPercentageReward",name:null,pointBackRates:[{rate:.3},{rate:.7},{rate:2,limit:500}]},stores:fe,payments:["信用卡","Apple Pay","Samsung Pay","Google Pay"]},{rewardStrategy:{type:"TruncatedPercentageReward",name:null,pointBackRates:[{rate:.3},{rate:.7},{rate:2,limit:500}]},payments:["Line Pay","街口支付","悠遊付","橘子支付","icash pay"]},_e]}},{id:E(),config:{name:"UP選",rewards:[{rewardStrategy:{type:"TruncatedPercentageReward",name:null,pointBackRates:[{rate:.3},{rate:.7},{rate:3.5,limit:2e3}]},stores:fe,payments:["信用卡","Apple Pay","Samsung Pay","Google Pay"]},{rewardStrategy:{type:"TruncatedPercentageReward",name:null,pointBackRates:[{rate:.3},{rate:.7},{rate:3.5,limit:2e3}]},payments:["Line Pay","街口支付","悠遊付","橘子支付","icash pay"]},_e]}}],updateAt:new Date("2024/12/01 00:00:00").toISOString()}],yt=Ie[0],Pe=["政府稅款","公共事業代扣繳","交通違規罰鍰","分期付款"],he=["全盈+PAY","icash pay","OPEN錢包","My FamiPay"],$e=[{name:"旅人無限卡",description:null,cardUrl:"https://www.hsbc.com.tw/credit-cards/products/travel/visa-infinite/",storeBlackList:Pe,paymentBlackList:he,pointExchanges:[{id:E(),config:{name:"長榮航空哩程",airlineCode:"EVA",pointsPerMile:1,milesPerUnit:1}}],plans:[{id:E(),config:{name:null,rewards:[{rewardStrategy:{type:"AccumulatedPointsReward",name:"國外消費",spendingPerPoint:10},transactionType:"Foreign"},{rewardStrategy:{type:"AccumulatedPointsReward",name:"國內消費",spendingPerPoint:18},transactionType:"Domestic"}]}}],updateAt:new Date("2024/12/01 00:00:00").toISOString()},{name:"旅人御璽卡",description:null,cardUrl:"https://www.hsbc.com.tw/credit-cards/products/travel/visa-signature/",storeBlackList:Pe,paymentBlackList:he,pointExchanges:[{id:E(),config:{name:"長榮航空哩程",airlineCode:"EVA",pointsPerMile:1,milesPerUnit:1}}],plans:[{id:E(),config:{name:null,rewards:[{rewardStrategy:{type:"AccumulatedPointsReward",name:"國外消費",spendingPerPoint:15},transactionType:"Foreign"},{rewardStrategy:{type:"AccumulatedPointsReward",name:"國內消費",spendingPerPoint:18},transactionType:"Domestic"}]}}],updateAt:new Date("2024/12/01 00:00:00").toISOString()},{name:"旅人輕旅卡",description:null,cardUrl:"https://www.hsbc.com.tw/credit-cards/products/travel/visa-light/",storeBlackList:Pe,paymentBlackList:he,pointExchanges:[{id:E(),config:{name:"長榮航空哩程",airlineCode:"EVA",pointsPerMile:1,milesPerUnit:1}}],plans:[{id:E(),config:{name:null,rewards:[{rewardStrategy:{type:"AccumulatedPointsReward",name:"國外消費",spendingPerPoint:20},transactionType:"Foreign"},{rewardStrategy:{type:"AccumulatedPointsReward",name:"國內消費",spendingPerPoint:20},transactionType:"Domestic"}]}}],updateAt:new Date("2024/12/01 00:00:00").toISOString()}],gt=$e[2],vt=[pt,gt,yt],ft=[...ut,...$e,...mt,...Ie],ke=s=>Array.isArray(s)&&s.every(t=>Array.isArray(t)&&t.length===2&&typeof t[0]=="string"&&Array.isArray(t[1])&&t[1].every(a=>typeof a=="string")),Ve=[["7-ELEVEN",["7-11","Seven Eleven","統一超商","小7"]],["ANA全日空",["ANA","全日空","All Nippon Airways","NH"]],["ATT 4 FUN",["ATT4FUN","ATT信義"]],["App Store",["蘋果應用商店"]],["Apple Arcade",["蘋果遊戲訂閱服務"]],["Apple Music",["蘋果音樂","Apple音樂"]],["Apple One",["蘋果One訂閱"]],["Apple TV+",["Apple TV Plus"]],["Apple Wallet ICOCA",["ICOCA電子票","Apple錢包ICOCA"]],["Apple Wallet PASMO",["PASMO電子票","Apple錢包PASMO"]],["Apple Wallet SUICA",["SUICA電子票","Apple錢包SUICA"]],["CITYLINK",["City Link"]],["Disney+",["Disney Plus","迪士尼+"]],["Google Play",["Google應用商店"]],["Grab",["Grab Taxi","Grab叫車"]],["MITSUI OUTLET PARK 台中港",["三井台中港","三井OUTLET台中"]],["MITSUI OUTLET PARK 台南",["三井台南","三井OUTLET台南"]],["MITSUI OUTLET PARK 林口",["三井林口","三井OUTLET林口"]],["Mitsui Shopping Park LaLaport 台中",["LaLaport台中","三井LaLaport台中"]],["Netflix",["網飛"]],["Nintendo",["任天堂","Switch","老任"]],["PChome 24h購物(不含儲值及電子票券)",["PChome","PChome購物"]],["Tiger City",["老虎城","Tiger City購物中心"]],["Trip.com",["攜程"]],["Uber Eats (不含 Uber One)",["優步外送"]],["foodpanda",["熊貓外送","Food Panda"]],["iCloud",["蘋果雲端","iCloud雲端"]],["iRent",["i Rent"]],["iTunes",["蘋果iTunes"]],["中友百貨",["中友"]],["中華航空",["China Airlines","CAL","CI","華航"]],["亞洲航空",["AirAsia","亞航","AXM","AK"]],["京站",["Q Square","京站商場"]],["全家便利商店",["FamilyMart","全家"]],["全球迪士尼飯店",["Disney Hotels"]],["全聯福利中心",["PX Mart"]],["南紡購物中心",["Tainan Spinnery Mall","南紡"]],["博客來",["Books.com.tw"]],["卡達航空",["Qatar Airways","卡航","QTR","QR"]],["可樂旅遊",["Cola Travel","可樂旅行社"]],["台北101",["Taipei 101","101大樓"]],["台灣中油-直營",["中油直營","直營中油"]],["台灣大車隊",["Taiwan Taxi","大車隊"]],["台灣虎航",["Tigerair Taiwan","台虎","TWA","IT"]],["台灣高鐵",["Taiwan High Speed Rail"]],["台茂購物中心",["TaiMall"]],["吉卜力公園",["Ghibli Park"]],["國泰航空",["Cathay Pacific","國泰","CPA","CX","Cathay Pacific Airways"]],["土耳其航空",["Turkish Airlines","土航","THY","TK"]],["夢時代",["Dream Mall"]],["大阪環球影城(USJ)",["Universal Studios Japan"]],["大韓航空",["Korean Air","韓航","KAL","KE"]],["大魯閣新時代",["Taroko Mall","大魯閣"]],["太平洋百貨",["Pacific Department Store","太平洋"]],["好樂迪KTV",["Holiday"]],["家樂福",["Carrefour"]],["屈臣氏",["Watsons"]],["康是美",["Cosmed"]],["捷星航空",["JST","JQ","Jetstar Airways"]],["新加坡航空",["SIA","SQ","Singapore Airlines"]],["日本航空",["JAL","JL","Japan Airlines"]],["星宇航空",["starlux","SJX","JX","STARLUX Airlines"]],["樂桃航空",["APJ","MM","Peach Aviation"]],["法國航空",["AFR","AF","Air France"]],["聯合航空",["UAL","UA","United Airlines"]],["蝦皮購物",["shopee"]],["越捷航空",["VJC","VJ","VietJet Air"]],["達美航空",["DAL","DL","Delta Air Lines"]],["遠東百貨",["遠百"]],["酷航",["SCO","TR","Scoot"]],["長榮航空",["EVA","BR","EVA Airlines","EVA Air"]],["阿聯酋航空",["UAE","EK","Emirates"]],["麥當勞",["McDonald's"]],["IKEA",["宜家家居"]],["星巴克",["starbucks"]]],D=new qe(localStorage,{onlyShowCurrentPlan:s=>typeof s=="boolean",onlyShowCurrentPointExchange:s=>typeof s=="boolean",commonPaymentMethods:(()=>{const s=new Set(["信用卡","Apple Pay","Samsung Pay","Google Pay","Line Pay","Fitbit Pay","Garmin Pay","Hami Pay","街口支付","全盈+PAY","全支付","Pi錢包","橘子支付","歐付寶","icash pay","OPEN錢包","My FamiPay","悠遊付","ezPay","GOMAJI Pay","friday wallet","PayPal","PX Pay","中油Pay","台灣Pay","支付寶"]);return t=>Array.isArray(t)&&t.every(a=>s.has(a)===!0)})(),cardConfigs:(()=>{const s=new Set(["信用卡","Apple Pay","Samsung Pay","Google Pay","Line Pay","Fitbit Pay","Garmin Pay","Hami Pay","街口支付","全盈+PAY","全支付","Pi錢包","橘子支付","歐付寶","icash pay","OPEN錢包","My FamiPay","悠遊付","ezPay","GOMAJI Pay","friday wallet","PayPal","PX Pay","中油Pay","台灣Pay","支付寶"]),t=new Set(["信用卡","Apple Pay","Samsung Pay","Google Pay","Line Pay","Fitbit Pay","Garmin Pay","Hami Pay","街口支付","全盈+PAY","全支付","Pi錢包","橘子支付","歐付寶","icash pay","OPEN錢包","My FamiPay","悠遊付","ezPay","GOMAJI Pay","friday wallet","PayPal","PX Pay","中油Pay","台灣Pay","支付寶"]),a=new Set(["信用卡","Apple Pay","Samsung Pay","Google Pay","Line Pay","Fitbit Pay","Garmin Pay","Hami Pay","街口支付","全盈+PAY","全支付","Pi錢包","橘子支付","歐付寶","icash pay","OPEN錢包","My FamiPay","悠遊付","ezPay","GOMAJI Pay","friday wallet","PayPal","PX Pay","中油Pay","台灣Pay","支付寶"]),o=e=>typeof e.name=="string"&&(e.description===null||typeof e.description=="string")&&(e.cardUrl===null||typeof e.cardUrl=="string")&&(e.storeBlackList===void 0||Array.isArray(e.storeBlackList)&&e.storeBlackList.every(y=>typeof y=="string"))&&(e.paymentBlackList===void 0||Array.isArray(e.paymentBlackList)&&e.paymentBlackList.every(y=>s.has(y)===!0))&&(e.selectedPlanId===void 0||typeof e.selectedPlanId=="string"&&RegExp(/(.*)\x2d(.*)\x2d(.*)\x2d(.*)\x2d(.*)/).test(e.selectedPlanId))&&Array.isArray(e.plans)&&e.plans.every(y=>typeof y=="object"&&y!==null&&l(y))&&typeof e.updateAt=="string"&&RegExp(/^[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?\x2d[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?\x2d[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?T[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?:[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?:[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?\.[+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?Z$/).test(e.updateAt)&&(e.selectedPointExchangeId===void 0||typeof e.selectedPointExchangeId=="string"&&RegExp(/(.*)\x2d(.*)\x2d(.*)\x2d(.*)\x2d(.*)/).test(e.selectedPointExchangeId))&&Array.isArray(e.pointExchanges)&&e.pointExchanges.every(y=>typeof y=="object"&&y!==null&&T(y)),l=e=>typeof e.id=="string"&&RegExp(/(.*)\x2d(.*)\x2d(.*)\x2d(.*)\x2d(.*)/).test(e.id)&&typeof e.config=="object"&&e.config!==null&&r(e.config),r=e=>(e.name===null||typeof e.name=="string")&&Array.isArray(e.rewards)&&e.rewards.every(y=>typeof y=="object"&&y!==null&&h(y))&&(e.condition===null||e.condition===void 0||e.condition==="Birthday"),h=e=>typeof e.rewardStrategy=="object"&&e.rewardStrategy!==null&&O(e.rewardStrategy)&&(e.transactionType===null||e.transactionType===void 0||e.transactionType==="Domestic"||e.transactionType==="Foreign")&&(e.stores===void 0||Array.isArray(e.stores)&&e.stores.every(y=>typeof y=="string"))&&(e.storeBlackList===void 0||Array.isArray(e.storeBlackList)&&e.storeBlackList.every(y=>typeof y=="string"))&&(e.payments===void 0||Array.isArray(e.payments)&&e.payments.every(y=>t.has(y)===!0))&&(e.paymentBlackList===void 0||Array.isArray(e.paymentBlackList)&&e.paymentBlackList.every(y=>a.has(y)===!0))&&(e.condition===null||e.condition===void 0||e.condition==="Birthday"),p=e=>Array.isArray(e.pointBackRates)&&e.pointBackRates.every(y=>typeof y=="object"&&y!==null&&m(y))&&(e.name===null||typeof e.name=="string")&&e.type==="RoundedPercentageReward",m=e=>typeof e.rate=="number"&&(e.limit===void 0||typeof e.limit=="number"),A=e=>Array.isArray(e.pointBackRates)&&e.pointBackRates.every(y=>typeof y=="object"&&y!==null&&m(y))&&(e.name===null||typeof e.name=="string")&&e.type==="TruncatedPercentageReward",S=e=>typeof e.spendingPerPoint=="number"&&(e.name===null||typeof e.name=="string")&&e.type==="AccumulatedPointsReward",d=e=>typeof e.spendingPerPoint=="number"&&(e.name===null||typeof e.name=="string")&&e.type==="FixedRatePointsReward",T=e=>typeof e.id=="string"&&RegExp(/(.*)\x2d(.*)\x2d(.*)\x2d(.*)\x2d(.*)/).test(e.id)&&typeof e.config=="object"&&e.config!==null&&f(e.config),f=e=>(e.name===null||typeof e.name=="string")&&typeof e.airlineCode=="string"&&typeof e.pointsPerMile=="number"&&typeof e.milesPerUnit=="number",O=e=>e.type==="TruncatedPercentageReward"?A(e):e.type==="RoundedPercentageReward"?p(e):e.type==="FixedRatePointsReward"?d(e):e.type==="AccumulatedPointsReward"?S(e):!1;return e=>Array.isArray(e)&&e.every(y=>typeof y=="object"&&y!==null&&o(y))})(),conditionTypes:s=>Array.isArray(s)&&s.every(t=>t==="Birthday"),aliasType:s=>s==="default"||s==="additional"||s==="custom",customAliases:ke},"bestMileageCards"),Oe=["default","additional","custom"],ie=He("BestMileageCards",()=>{const s=M(null);function t(n){s.value=n}function a(){s.value=null}De(()=>{const n=D.get("cardConfigs")??[];A.value=new Map(n.map(x=>[E(),x]))});const o=M(D.get("onlyShowCurrentPlan")??!1);function l(n){D.set("onlyShowCurrentPlan",n),o.value=n}const r=M(D.get("onlyShowCurrentPointExchange")??!1);function h(n){D.set("onlyShowCurrentPointExchange",n),r.value=n}const p=M(D.get("commonPaymentMethods")??["信用卡","Apple Pay","Line Pay","街口支付"]);function m([...n]){n=[...new Set(n)],D.set("commonPaymentMethods",n),p.value=n}const A=M(new Map),S=Q(()=>new Map([...A.value.entries()].map(([n,x])=>[n,Ee(x)]))),d=Q(()=>S.value.size===0?vt.map(n=>Ee(n)):[...S.value.values()]);function T(n,x){A.value.set(n,x),D.set("cardConfigs",[...A.value.values()])}function f(n){A.value.delete(n),D.set("cardConfigs",[...A.value.values()])}function O(n,x){const $=A.value.get(n);if($===void 0)return!1;try{A.value.set(n,{...$,selectedPlanId:x})}catch{return!1}return D.set("cardConfigs",[...A.value.values()]),!0}function e(n,x){const $=A.value.get(n);if($===void 0)return!1;try{A.value.set(n,{...$,selectedPointExchangeId:x})}catch{return!1}return D.set("cardConfigs",[...A.value.values()]),!0}const y=Q(()=>Le(Se(d.value.flatMap(n=>n.storeList)),"asc")),K=M(D.get("conditionTypes")??[]);function z([...n]){K.value=n,D.set("conditionTypes",n)}const L=M(D.get("aliasType")??"default");function i(n){Oe.includes(n)&&(L.value=n,D.set("aliasType",n))}const u=M(new Map(D.get("customAliases")??[]));function k(n,x){x.length===0?u.value.delete(n):u.value.set(n,x),D.set("customAliases",[...u.value])}function w(n){u.value=new Map(n),D.set("customAliases",n)}const N=Q(()=>{const n=[];["default","additional"].includes(L.value)&&n.push(...Ve),["additional","custom"].includes(L.value)&&n.push(...u.value);const x=new Map;for(const[$,F]of n){const B=x.get($)??new Set;for(const H of F)B.add(H);x.set($,B)}return x});return{dialog:Z(s),openDialog:t,closeDialog:a,onlyShowCurrentPlan:Z(o),updateOnlyShowCurrentPlan:l,onlyShowCurrentPointExchange:Z(r),updateOnlyShowCurrentPointExchange:h,commonPaymentMethods:Z(p),updateCommonPaymentMethods:m,cardConfigs:Z(A),cards:S,showCards:d,updateCardConfig:T,deleteCardConfig:f,updatePlan:O,updatePointExchange:e,storeList:Z(y),conditionTypes:Z(K),updateConditionTypes:z,aliasType:Z(L),storeAliases:N,updateAliasType:i,customAliases:Z(u),updateCustomAliases:k,updateAllCustomAliases:w}}),_t={class:"flex-col gap-24px my-16px"},Pt={class:"gap-8px flex justify-around"},ht={class:"flex mx-16px"},wt=ne({__name:"CommonSettings",setup(s){const t=ie(),{onlyShowCurrentPlan:a,onlyShowCurrentPointExchange:o,commonPaymentMethods:l,conditionTypes:r}=se(t);return(h,p)=>{const m=P("v-switch"),A=P("v-select"),S=P("v-label");return v(),b("div",_t,[g("div",Pt,[c(m,{"model-value":C(a),"hide-details":"",color:"blue","onUpdate:modelValue":p[0]||(p[0]=d=>d!==null&&C(t).updateOnlyShowCurrentPlan(d))},{label:_(()=>p[4]||(p[4]=[g("p",{class:"text-0.75rem"},"只顯示當前方案",-1)])),_:1},8,["model-value"]),c(m,{"model-value":C(o),"hide-details":"",color:"blue","onUpdate:modelValue":p[1]||(p[1]=d=>d!==null&&C(t).updateOnlyShowCurrentPointExchange(d))},{label:_(()=>p[5]||(p[5]=[g("p",{class:"text-0.75rem"},"只顯示當前交換方式",-1)])),_:1},8,["model-value"])]),g("div",null,[c(A,{"model-value":C(l),items:C(Le)(C(it),"asc"),label:"使用中的付款方式",multiple:"","hide-details":"","onUpdate:modelValue":p[2]||(p[2]=d=>d!==null&&C(t).updateCommonPaymentMethods(d))},null,8,["model-value","items"])]),g("div",null,[c(S,{text:"其他設定"}),g("div",ht,[c(m,{"model-value":C(r),label:"生日中",value:"Birthday","hide-details":"",color:"blue","onUpdate:modelValue":p[3]||(p[3]=d=>d!==null&&C(t).updateConditionTypes(d))},null,8,["model-value"])])])])}}}),xt={class:"relative"},At={key:0,class:"text-red ml-2px"},we=ne({__name:"TextFiled",props:Je({required:{type:Boolean,default:!1},label:{},isUrl:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const t=Ke(s,"modelValue"),a=Q(()=>{const l=[];return s.required&&l.push(r=>!!r||"此欄位為必填"),s.isUrl&&l.push(r=>!!(r===null||r===""||r.startsWith("https://"))||"請填寫正確的網址 (需為 https:// 開頭)"),l});function o(l){l=(l==null?void 0:l.trim())??null,t.value=ye(l)?l:null}return(l,r)=>{const h=P("v-text-field");return v(),J(h,{clearable:"",rules:a.value,"model-value":t.value,"onUpdate:modelValue":o},{label:_(()=>[g("p",xt,[j(I(l.label)+" ",1),l.required?(v(),b("span",At,"*")):W("",!0)])]),_:1},8,["rules","model-value"])}}});function ae(s){if(s===null||typeof s!="object")return s;if(Array.isArray(s))return s.map(a=>ae(a));if(s instanceof Map)return new Map(Array.from(s.entries()).map(([a,o])=>[ae(a),ae(o)]));if(s instanceof Set)return new Set(Array.from(s.values()).map(a=>ae(a)));if(s instanceof Date)return new Date(s.getTime());if(s instanceof RegExp)return new RegExp(s.source,s.flags);const t={};return Object.keys(s).forEach(a=>{t[a]=ae(s[a])}),t}const kt={class:"flex-col gap-4px h-full overflow-hidden"},St={class:"flex justify-between"},Ct={class:"flex-1 gap-8px flex-col overflow-y-auto py-8px"},bt={class:"flex items-center justify-between"},Rt=["onClick"],Tt={key:0,class:"flex-col gap-2 m-16px"},Et={class:"overflow-y-auto w-full p-24px"},Lt={key:0,class:"flex-col gap-8px"},Bt={class:"flex items-center justify-between min-h-1rem"},Ut={key:0,class:"mdi mdi-check-circle text-24px"},Mt={class:"flex items-center justify-between min-h-1rem gap-4px"},It={class:"flex-col gap-4px"},$t={class:"opacity-50 text-0.75rem"},Vt={key:0,class:"mdi mdi-check-circle text-24px"},Ot={class:"flex-col gap-4px m-8px"},Nt={class:"flex-col"},Ft={class:"text-1rem"},Dt={class:"text-0.75rem"},Jt=ne({__name:"CreditCardManagement",setup(s){const t=ie(),{cardConfigs:a,cards:o}=se(t),l=M(null),r=M(null),h=Q(()=>{const T=r.value===null?null:o.value.get(r.value)??null;return T===null?null:T}),p=M(!1),m=M([]);function A(){for(const T of m.value)t.updateCardConfig(E(),T),p.value=!1}function S(){l.value!==null&&(t.updateCardConfig(l.value.id,l.value.config),l.value=null)}function d(){l.value!==null&&(t.deleteCardConfig(l.value.id),l.value=null)}return(T,f)=>{const O=P("v-label"),e=P("v-btn"),y=P("v-card"),K=P("v-toolbar-title"),z=P("v-spacer"),L=P("v-toolbar-items"),i=P("v-toolbar"),u=P("v-dialog"),k=P("v-card-text"),w=P("v-card-actions"),N=P("v-checkbox");return v(),b(G,null,[g("div",kt,[g("div",St,[c(O,{text:"點擊鉛筆編輯卡片，點擊卡片切換方案",class:"!text-0.9rem"}),c(e,{text:"匯入",onClick:f[0]||(f[0]=()=>{m.value=[],p.value=!0})})]),g("div",Ct,[(v(!0),b(G,null,X(C(a).entries(),([n,x],$)=>(v(),J(y,{key:$,density:"compact",class:"mx-auto w-full flex-shrink-0",variant:"outlined",title:x.name,text:x.description??"",onClick:()=>r.value=n},{title:_(()=>[g("div",bt,[j(I(x.name)+" ",1),g("span",{class:"mdi mdi-pencil absolute top-0 py-0.625rem px-1rem right-0",onClick:Ge(()=>l.value={id:n,config:C(ae)(x)},["stop"])},null,8,Rt)])]),_:2},1032,["title","text","onClick"]))),128))])]),c(u,{"model-value":!!l.value,fullscreen:"","onUpdate:modelValue":f[6]||(f[6]=n=>l.value=null)},{default:_(()=>[c(y,null,{default:_(()=>[c(i,null,{default:_(()=>[c(e,{icon:"mdi-close",onClick:f[1]||(f[1]=n=>l.value=null)}),c(K,null,{default:_(()=>f[12]||(f[12]=[j("編輯卡片")])),_:1}),c(z),c(L,null,{default:_(()=>[c(e,{text:"Save",onClick:S})]),_:1})]),_:1}),l.value?(v(),b("div",Tt,[c(we,{modelValue:l.value.config.name,"onUpdate:modelValue":f[2]||(f[2]=n=>l.value.config.name=n),label:"卡片名稱",required:""},null,8,["modelValue"]),c(we,{modelValue:l.value.config.description,"onUpdate:modelValue":f[3]||(f[3]=n=>l.value.config.description=n),label:"卡片描述"},null,8,["modelValue"]),c(we,{modelValue:l.value.config.cardUrl,"onUpdate:modelValue":f[4]||(f[4]=n=>l.value.config.cardUrl=n),"is-url":"",label:"信用卡網頁"},null,8,["modelValue"]),g("div",null,[c(e,{class:"text-red",text:"刪除",onClick:f[5]||(f[5]=n=>C(t).openDialog({text:"確定要刪除嗎？",events:[{text:"取消"},{text:"刪除",event:d,class:"text-red"}]}))})])])):W("",!0)]),_:1})]),_:1},8,["model-value"]),c(u,{"model-value":!!r.value,"onUpdate:modelValue":f[8]||(f[8]=n=>r.value=null)},{default:_(()=>[c(y,{"min-width":"100%"},{default:_(()=>[c(k,{class:"max-h-80dvh overflow-hidden flex !p-0"},{default:_(()=>[g("div",Et,[h.value!==null?(v(),b("div",Lt,[f[13]||(f[13]=j(" 切換方案 ")),(v(!0),b(G,null,X(h.value.selectablePlan??[],(n,x)=>(v(),J(y,{key:x,density:"compact",class:"mx-auto w-full flex-shrink-0",variant:"outlined",onClick:()=>r.value&&C(t).updatePlan(r.value,n.id)},{default:_(()=>[c(k,null,{default:_(()=>[g("div",Bt,[j(I(n.name??"預設")+" ",1),n.id===h.value.selectedPlanId?(v(),b("span",Ut)):W("",!0)])]),_:2},1024)]),_:2},1032,["onClick"]))),128)),f[14]||(f[14]=j(" 切換點數交換方式 ")),(v(!0),b(G,null,X(h.value.selectablePointExchange??[],(n,x)=>(v(),J(y,{key:x,density:"compact",class:"mx-auto w-full flex-shrink-0",variant:"outlined",onClick:()=>r.value&&C(t).updatePointExchange(r.value,n.id)},{default:_(()=>[c(k,null,{default:_(()=>[g("div",Mt,[g("p",It,[j(I(n.name??"預設")+" ",1),g("span",$t,I(n.description),1)]),n.id===h.value.selectedPointExchangeId?(v(),b("span",Vt)):W("",!0)])]),_:2},1024)]),_:2},1032,["onClick"]))),128))])):W("",!0)])]),_:1}),c(w,null,{default:_(()=>[c(e,{class:"ms-auto",text:"Close",onClick:f[7]||(f[7]=n=>r.value=null)})]),_:1})]),_:1})]),_:1},8,["model-value"]),c(u,{modelValue:p.value,"onUpdate:modelValue":f[11]||(f[11]=n=>p.value=n),fullscreen:""},{default:_(()=>[c(y,null,{default:_(()=>[c(i,null,{default:_(()=>[c(e,{icon:"mdi-close",onClick:f[9]||(f[9]=n=>p.value=!1)}),c(K,null,{default:_(()=>f[15]||(f[15]=[j("請選擇卡片")])),_:1}),c(z),c(L,null,{default:_(()=>[c(e,{text:"匯入",onClick:A})]),_:1})]),_:1}),g("div",Ot,[(v(!0),b(G,null,X(C(ft),(n,x)=>(v(),J(N,{key:x,modelValue:m.value,"onUpdate:modelValue":f[10]||(f[10]=$=>m.value=$),value:n,"hide-details":"",color:"blue",density:"comfortable",class:"import-card-checkbox"},{label:_(()=>[g("div",Nt,[g("p",Ft,I(n.name),1),g("p",Dt,I(n.description),1)])]),_:2},1032,["modelValue","value"]))),128))])]),_:1})]),_:1},8,["modelValue"])],64)}}}),Kt=Ue(Jt,[["__scopeId","data-v-dc72d8a9"]]),Gt={class:"gap-8px h-full flex-col"},jt={class:"flex items-center flex-wrap gap-x-8px"},zt={class:"gap-8px flex-center"},Wt={ref:"rewardCardList",class:"flex-col gap-4px flex-grow-1 overflow-y-auto"},Xt={class:"flex items-center gap-4px overflow-hidden w-full"},Ht={class:"text-12px opacity-50 truncate flex-grow-1"},Yt={key:0,class:"fa-solid fa-circle-check"},qt={class:"flex-col gap-8px"},Zt={class:"text-0.75rem"},Qt={class:"text-wrap"},ea={class:"flex-col"},ta={class:"flex justify-between"},aa=["href"],na={key:0},la={key:1},oa="其他店家",sa=ne({__name:"SearchReward",setup(s){const t=oe(0),a=oe(2),o=Be(0),{onlyShowCurrentPlan:l,onlyShowCurrentPointExchange:r,commonPaymentMethods:h,showCards:p,conditionTypes:m,storeAliases:A,storeList:S}=se(ie()),d=M(0),T=M(null),f=M("Domestic"),O=M([]),e=xe("rewardCardList"),y=xe("storeAutoComplete"),K=Q(()=>{const k=S.value.map(w=>({store:w,aliases:[...A.value.get(w)??[]]}));return[{store:oa},...k]});function z(k,w,N){return w=w.toLowerCase(),[k,...(N==null?void 0:N.raw.aliases)??[]].map(x=>x.toLowerCase()).some(x=>x.includes(w))}const L=Q(()=>{var N;const k={amount:d.value,acceptedPayments:O.value,transactionAttributesType:f.value,currentConditions:[...m.value]};ye(T.value)&&(k.transactionStore=T.value);const w=[];for(const n of p.value){const x=n.getRewardInfos(k,{onlyCurrentPlan:l.value,onlyCurrentExchangeStrategy:r.value}),$=!l.value||!r.value,F=!r.value&&n.selectablePointExchange.length>1;for(const B of x){const H={cardName:n.name,planName:B.planName,rewardName:B.rewardName,miles:B.miles,payments:B.payments,airLinesCode:B.airlineCode,isSelectedPlan:$&&B.planId===n.selectedPlanId,calculateDetail:u(B.rewardStrategy,B.pointExchangeStrategy),description:B.rewardStrategy===null?null:`${B.rewardStrategy.description}，${B.pointExchangeStrategy.description}`,cardUrl:n.cardUrl,cardDescription:n.description,pointExchangeName:F?B.pointExchangeName:null};w.push(H)}}return(N=e.value)==null||N.scrollTo({top:0,behavior:"smooth"}),Te(Te(w,"isSelectedPlan","desc"),"miles","desc")}),i=M(null);function u(k,w){const{pointsPerMile:N,milesPerUnit:n,airlineCode:x}=w,$="回饋計算:";switch(k==null?void 0:k.type){case"RoundedPercentageReward":case"TruncatedPercentageReward":{const F=k.type==="RoundedPercentageReward"?t:o;let B=0;return[$,...k.pointBackRates.map(({rate:H,limit:ee})=>{const te=Math.min(F(d.value*H/100),ee??1/0);B+=te;const R=ee!==void 0?` (limit ${ee})`:"";return`${d.value} * ${H}% = ${te}${R}`}),`總計 ${B} points`,`${B} / ${N} * ${n} = ${w.calculateMiles(B)} ${x}`]}case"AccumulatedPointsReward":{const F=a(d.value/k.spendingPerPoint);return[$,`${d.value} / ${k.spendingPerPoint} = ${F} points`,`${F} / ${N} * ${n} = ${w.calculateMiles(F)} ${x}`]}case"FixedRatePointsReward":{const F=o(d.value/k.spendingPerPoint);return[$,`${d.value} / ${k.spendingPerPoint} = ${F} points (小數省略)`,`${F} / ${N} * ${n} = ${w.calculateMiles(F)} ${x}`]}default:return[]}}return(k,w)=>{const N=P("v-text-field"),n=P("v-autocomplete"),x=P("v-label"),$=P("v-checkbox"),F=P("v-radio"),B=P("v-radio-group"),H=P("v-card"),ee=P("v-btn"),te=P("v-dialog");return v(),b(G,null,[g("div",Gt,[c(N,{"model-value":d.value,class:"flex-grow-0",density:"comfortable","hide-details":"",label:"交易金額",inputmode:"decimal",clearable:d.value!==0,"onUpdate:modelValue":w[0]||(w[0]=R=>d.value=isNaN(parseFloat(R))?0:parseFloat(R))},null,8,["model-value","clearable"]),c(n,{ref:"storeAutoComplete",modelValue:T.value,"onUpdate:modelValue":w[1]||(w[1]=R=>T.value=R),"custom-filter":z,class:"flex-grow-0",density:"comfortable","hide-details":"","item-value":"store","item-title":"store",label:"消費店家",items:K.value,clearable:C(ye)(T.value),placeholder:"全部店家","onUpdate:menu":w[2]||(w[2]=R=>{var Y;return!R&&((Y=C(y))==null?void 0:Y.blur())})},null,8,["modelValue","items","clearable"]),g("div",null,[c(x,{text:"支援的付款方式"}),g("div",jt,[(v(!0),b(G,null,X(C(h),(R,Y)=>(v(),J($,{key:Y,modelValue:O.value,"onUpdate:modelValue":w[3]||(w[3]=V=>O.value=V),density:"compact",value:R,"hide-details":"",label:R},null,8,["modelValue","value","label"]))),128))])]),g("div",zt,[c(x,{text:"交易類型"}),c(B,{modelValue:f.value,"onUpdate:modelValue":w[4]||(w[4]=R=>f.value=R),"hide-details":"",inline:""},{default:_(()=>[c(F,{density:"compact",label:"國內交易",value:"Domestic"}),c(F,{density:"compact",label:"國外交易",value:"Foreign"})]),_:1},8,["modelValue"])]),g("div",Wt,[(v(!0),b(G,null,X(L.value,(R,Y)=>(v(),J(H,{key:Y,density:"compact",class:"mx-auto w-full flex-shrink-0",variant:"outlined",onClick:()=>i.value=R},{title:_(()=>[g("div",Xt,[j(I(R.miles)+" ",1),g("p",Ht,I(R.airLinesCode)+" "+I(R.payments.length===0?"":` (限定支付: ${R.payments.join(", ")})`),1),R.isSelectedPlan?(v(),b("i",Yt)):W("",!0)])]),text:_(()=>[g("div",qt,[g("p",Zt,I(`${R.cardName} ${R.planName??""} ${R.rewardName??""} ${R.pointExchangeName??""}`),1)])]),_:2},1032,["onClick"]))),128))],512)]),c(te,{"model-value":!!i.value,"onUpdate:modelValue":w[6]||(w[6]=R=>i.value=null)},{default:_(()=>[i.value?(v(),J(H,{key:0,class:"mx-auto reward-detail-dialog","min-width":"100%",title:`${i.value.cardName} ${i.value.planName??""} ${i.value.rewardName??""}`},{subtitle:_(()=>[g("p",Qt,I(i.value.description??""),1)]),text:_(()=>[g("div",ea,[g("p",ta,[w[7]||(w[7]=j(" 卡片說明： ")),i.value.cardUrl!==null?(v(),b("a",{key:0,target:"_blank",class:"underline",href:i.value.cardUrl}," 網站 ",8,aa)):W("",!0)]),i.value.cardDescription!==""||i.value.cardDescription!==null?(v(),b("p",na,I(i.value.cardDescription),1)):W("",!0),i.value.pointExchangeName!==""?(v(),b("p",la,I(i.value.pointExchangeName),1)):W("",!0),w[8]||(w[8]=g("br",null,null,-1)),g("p",null,"消費金額: "+I(d.value),1),g("p",null,"哩程預估: "+I(i.value.miles)+" "+I(i.value.airLinesCode),1),w[9]||(w[9]=g("br",null,null,-1)),(v(!0),b(G,null,X(i.value.calculateDetail,(R,Y)=>(v(),b("p",{key:Y},I(R),1))),128))])]),actions:_(()=>[c(ee,{class:"ms-auto",text:"Close",onClick:w[5]||(w[5]=R=>i.value=null)})]),_:1},8,["title"])):W("",!0)]),_:1},8,["model-value"])],64)}}}),ia=Ue(sa,[["__scopeId","data-v-196965ef"]]),ra={class:"flex-col h-full overflow-hidden gap-8px"},da={class:"flex-shrink-0 flex-col gap-8px"},ca={key:0,class:"flex justify-between items-center"},ua={class:"flex gap-8px"},pa={key:0,class:"gap-4px flex-col flex-grow-1 overflow-y-auto"},ma={class:"text-1rem"},ya={class:"text-0.8rem"},ga={key:1,class:"flex-grow-1"},va={class:"flex-col gap-24px m-8px"},fa={class:"flex-col gap-4px"},_a=ne({__name:"StoreAliasManagement",setup(s){const t=ie(),{aliasType:a,customAliases:o,storeAliases:l}=se(t),r=xe("storeList"),h={default:"系統預設",additional:"預設+自定義",custom:"自定義"},p=M(!0),m=M(!1),A=M(!0),S=M("[]"),d=M(null),T=Q(()=>{let i;return a.value==="default"?i=Ve:a.value==="additional"?i=[...l.value].map(([u,k])=>[u,[...k]]):i=[...o.value],i.map(([u,k])=>({title:u,aliases:[...k]}))});be(()=>{var i;return(i=d.value)==null?void 0:i.title},i=>{if(i==null||d.value===null)return;const u=[...o.value.get(i)??[]];u[u.length-1]!==""&&u.push(""),d.value.aliases=u}),be(p,z),je(()=>{z(),m.value=!1,A.value=!0,p.value=!0});function f(i,u){if(d.value===null)return;let k=d.value.aliases;k[u]=i,k[k.length-1]!==""&&k.push("")}function O(i){if(a.value!=="default")if(i===null)d.value={title:null,aliases:[]};else{const u=[...o.value.get(i)??[]];u[u.length-1]!==""&&u.push(""),d.value={title:i,aliases:u}}}function e(){const{title:i,aliases:u}=d.value??{};i==null||u===void 0||(t.updateCustomAliases(i,[...new Set(u)].filter(ye)),d.value=null)}function y(i){if(i=i.trim(),S.value=i,m.value=!0,i===""){A.value=!0;return}try{const u=JSON.parse(i);A.value=ke(u)}catch(u){console.error(u),A.value=!1}}function K(){let i;if(p.value)i=!0;else{S.value===""&&(S.value="[]");try{const u=JSON.parse(S.value);ke(u)?(t.updateAllCustomAliases(u),i=!0):i=!1}catch(u){console.error(u),i=!1}}i?(alert("儲存成功"),m.value=!1):alert(`儲存失敗${p.value?"":"，JSON 不符合規則"}`)}function z(){S.value=JSON.stringify([...o.value],null,2)}function L(i){m.value||(i==="default"&&(p.value=!0),t.updateAliasType(i))}return(i,u)=>{const k=P("v-label"),w=P("v-btn"),N=P("v-btn-toggle"),n=P("v-switch"),x=P("v-card"),$=P("v-textarea"),F=P("v-toolbar-title"),B=P("v-spacer"),H=P("v-toolbar-items"),ee=P("v-toolbar"),te=P("v-autocomplete"),R=P("v-text-field"),Y=P("v-dialog");return v(),b(G,null,[g("div",ra,[g("div",da,[c(k,{text:"別名設定"}),c(N,{"model-value":C(a),rounded:"0",group:"",class:"w-full flex justify-center",disabled:m.value,"onUpdate:modelValue":L},{default:_(()=>[(v(!0),b(G,null,X(C(Oe),(V,q)=>(v(),J(w,{key:q,class:"flex-1",value:V},{default:_(()=>[j(I(h[V]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["model-value","disabled"]),C(a)!=="default"?(v(),b("div",ca,[g("div",ua,[p.value?(v(),J(w,{key:0,onClick:u[0]||(u[0]=V=>O(null))},{default:_(()=>u[6]||(u[6]=[j(" Add ")])),_:1})):(v(),J(w,{key:1,onClick:K},{default:_(()=>u[7]||(u[7]=[j(" Save ")])),_:1}))]),c(n,{modelValue:p.value,"onUpdate:modelValue":u[1]||(u[1]=V=>p.value=V),disabled:m.value,"hide-details":"",label:"圖示"},null,8,["modelValue","disabled"])])):W("",!0)]),p.value?(v(),b("div",pa,[(v(!0),b(G,null,X(T.value,(V,q)=>(v(),J(x,{key:q,density:"compact",class:"mx-auto w-full flex-shrink-0",variant:"outlined",onClick:le=>O(V.title)},{text:_(()=>[g("p",ma,I(V.title),1),g("p",ya,I(V.aliases.join(", ")),1)]),_:2},1032,["onClick"]))),128))])):(v(),b("div",ga,[c($,{"model-value":S.value,clearable:S.value!=="","auto-grow":"",disabled:C(a)==="default","max-rows":15,messages:m.value?"上方儲存完成後才能執行其他動作，離開這頁不會存檔":"","error-messages":A.value?"":"json 無效",label:"自定義別名設定檔","onUpdate:modelValue":y},null,8,["model-value","clearable","disabled","messages","error-messages"])]))]),c(Y,{"model-value":!!d.value,fullscreen:"","onUpdate:modelValue":u[5]||(u[5]=V=>d.value=null)},{default:_(()=>[d.value?(v(),J(x,{key:0},{default:_(()=>[c(ee,null,{default:_(()=>[c(w,{icon:"mdi-close",onClick:u[2]||(u[2]=V=>d.value=null)}),c(F,null,{default:_(()=>u[8]||(u[8]=[j("編輯商店別名")])),_:1}),c(B),c(H,null,{default:_(()=>[c(w,{text:"Save",variant:"text",onClick:e})]),_:1})]),_:1}),g("div",va,[c(te,{ref:"storeList",modelValue:d.value.title,"onUpdate:modelValue":u[3]||(u[3]=V=>d.value.title=V),class:"flex-grow-0","hide-details":"",label:"目標店家",items:C(t).storeList,placeholder:"選擇店家","onUpdate:menu":u[4]||(u[4]=V=>{var q;return!V&&((q=C(r))==null?void 0:q.blur())})},null,8,["modelValue","items"]),g("div",fa,[c(k,{text:"自定義別名列表"}),(v(!0),b(G,null,X(d.value.aliases,(V,q)=>(v(),J(R,{key:q,"hide-details":"",clearable:"","model-value":V,"onUpdate:modelValue":le=>f(le,q),"onClick:clear":()=>{var le;return(le=d.value)==null?void 0:le.aliases.splice(q,1)}},null,8,["model-value","onUpdate:modelValue","onClick:clear"]))),128))])])]),_:1})):W("",!0)]),_:1},8,["model-value"])],64)}}}),Pa={style:{height:"calc(100dvh - 56px)"},class:"overflow-hidden mt-56px p-8px"},ha={class:"w-full text-center"},wa={class:"w-full flex items-center justify-between px-8px"},xa=ne({__name:"App",setup(s){const t=ie(),{dialog:a}=se(t),o={查詢回饋:ia,信用卡管理:Kt,商家別名:_a,喜好設定:wt},l=Object.keys(o),r=M(!1),h=M(l[0]);return(p,m)=>{const A=P("v-app-bar-nav-icon"),S=P("v-app-bar-title"),d=P("v-app-bar"),T=P("v-list-item"),f=P("v-divider"),O=P("v-navigation-drawer"),e=P("v-app"),y=P("v-btn"),K=P("v-card"),z=P("v-dialog");return v(),b(G,null,[c(e,null,{default:_(()=>[c(d,{density:"comfortable",elevation:2},{prepend:_(()=>[c(A,{onClick:m[0]||(m[0]=L=>r.value=!r.value)},{default:_(()=>m[2]||(m[2]=[g("i",{class:"fa-solid fa-bars"},null,-1)])),_:1}),c(S,null,{default:_(()=>[j(I(h.value),1)]),_:1})]),_:1}),c(O,{modelValue:r.value,"onUpdate:modelValue":m[1]||(m[1]=L=>r.value=L)},{default:_(()=>[(v(!0),b(G,null,X(C(l),(L,i)=>(v(),b(G,{key:i},[c(T,{title:L,class:Re(["h-48px",{"text-emphasis":h.value===L}]),onClick:()=>{h.value=L,r.value=!1}},null,8,["title","class","onClick"]),c(f)],64))),128))]),_:1},8,["modelValue"]),g("main",Pa,[(v(),J(We,null,[(v(),J(ze(o[h.value])))],1024))])]),_:1}),c(z,{"model-value":!!C(a),"onUpdate:modelValue":C(t).closeDialog},{default:_(()=>[C(a)!==null?(v(),J(K,{key:0,class:"mx-auto","min-width":"100%"},{text:_(()=>[g("div",ha,I(C(a).text),1)]),actions:_(()=>[g("div",wa,[(v(!0),b(G,null,X(C(a).events,(L,i)=>(v(),J(y,{key:i,text:L.text,class:Re(L.class),variant:"elevated",onClick:async()=>{"event"in L&&await L.event(),C(t).closeDialog()}},null,8,["text","class","onClick"]))),128))])]),_:1})):W("",!0)]),_:1},8,["model-value","onUpdate:modelValue"])],64)}}}),Ce=Xe(xa);Ce.use(Ze);Ce.use(Ye());Ce.mount("#app");
//# sourceMappingURL=bestMileageCards-T2_OhDuI.js.map
