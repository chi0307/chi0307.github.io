var se=Object.defineProperty;var de=(i,o,r)=>o in i?se(i,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[o]=r;var j=(i,o,r)=>de(i,typeof o!="symbol"?o+"":o,r);import{i as h,e as L,a as ie,g as G,b as ce,c as M}from"./index-BGmbz_P8.js";import{f as P,s as ve,c as fe,a as me}from"./sorts-Bz4sjJ7i.js";import{d as ye,i as b,j as $,k as ge,w as Y,c as O,b as y,f as n,l as d,u as q,F as K,m as E,o as D,r as pe,h as Q,p as X,t as Z,g as ee}from"./main-CHE5YFYn.js";function le(){return{title:"新標籤",list:[],amount:0,localCurrencyCode:null,foreignCurrencyCode:null,locale:null}}const be=(()=>{const i=a=>Object.keys(a).every(C=>{const g=a[C];return g===void 0?!0:typeof C=="string"&&RegExp(/(.*)\x2d(.*)\x2d(.*)\x2d(.*)\x2d(.*)/).test(C)?typeof g=="object"&&g!==null&&o(g):!0}),o=a=>typeof a.title=="string"&&Array.isArray(a.list)&&a.list.every(C=>typeof C=="object"&&C!==null&&r(C))&&typeof a.amount=="number"&&(a.localCurrencyCode===null||typeof a.localCurrencyCode=="string")&&(a.foreignCurrencyCode===null||typeof a.foreignCurrencyCode=="string")&&(a.locale===null||typeof a.locale=="string"),r=a=>typeof a.id=="string"&&RegExp(/(.*)\x2d(.*)\x2d(.*)\x2d(.*)\x2d(.*)/).test(a.id)&&typeof a.date=="string"&&typeof a.sell=="number"&&typeof a.buy=="number";return a=>typeof a=="object"&&a!==null&&Array.isArray(a)===!1&&i(a)})();function B(i,o,r){if(h(r)&&h(o))try{return i.toLocaleString(o,{style:"currency",currency:r,minimumFractionDigits:0})}catch(a){L("parse currency and locale failed",a)}try{if(h(o))return i.toLocaleString(o)}catch(a){L("parse locale failed",a)}return i.toLocaleString()}class Ce{constructor(o,r){j(this,"storage");j(this,"typeChecker");this.storage=o,this.typeChecker=r}get(o){const r=this.storage.getItem(o);if(r===null)return null;try{const a=JSON.parse(r);if(this.typeChecker[o](a))return a;console.error(`storage ${o} check typing failed`)}catch(a){L(`storage ${o} parse failed`,a)}return null}set(o,r){if(!this.typeChecker[o](r))throw new Error(`Type error: Invalid data type for key "${o}"`);this.storage.setItem(o,JSON.stringify(r))}remove(o){this.storage.removeItem(o)}}const U=new Ce(localStorage,{averageExchangeRate:be}),xe={class:"m-24px flex-col gap-8px"},Ve={class:"flex-center w-full gap-4px"},ke={class:"flex-1"},he={class:"flex-1"},we=["onClick"],$e={class:"flex-col gap-8px"},Ee={class:"flex items-center justify-between w-full"},Ue=ye({__name:"AverageExchangeRate",setup(i){const o=b(()=>[{title:"日期",key:"date",nowrap:!0,sortable:!1},{title:`賣出${J.value}`,key:"sell",nowrap:!0,sortable:!1,align:"end"},{title:`買入${R.value}`,key:"buy",nowrap:!0,sortable:!1,align:"end"},{title:"匯率",key:"exchangeRate",nowrap:!0,sortable:!1},{title:`剩餘${R.value}`,key:"balance",nowrap:!0,sortable:!1,align:"end"},{key:"actions",sortable:!1}]),r=b(()=>a.value.map(l=>{var e,u,V,c,T,k;return{...l,sell:B(l.sell,(e=s.value)==null?void 0:e.locale,(u=s.value)==null?void 0:u.localCurrencyCode),buy:B(l.buy,(V=s.value)==null?void 0:V.locale,(c=s.value)==null?void 0:c.foreignCurrencyCode),balance:B(l.balance,(T=s.value)==null?void 0:T.locale,(k=s.value)==null?void 0:k.foreignCurrencyCode)}})),a=b(()=>{let l=F.value;return ve(fe(A.value,"date",me),"date").map(e=>{const u=l>e.buy?e.buy:l;return l-=u,{id:e.id,date:P(e.date,"yyyy/MM/dd"),sell:e.sell,buy:e.buy,exchangeRate:M(e.sell/e.buy,4),balance:u}})}),C=b(()=>{let l=0,e=0;for(const u of a.value)u.balance>0&&(e+=u.balance,l+=u.balance*u.exchangeRate);return e===0?0:M(l/e,4)}),g=$(!1),_=$(!1),p=$(null),m=$({}),s=b(()=>p.value!==null?m.value[p.value]??null:null),A=b(()=>{var l;return((l=s.value)==null?void 0:l.list)??[]}),F=b(()=>{var l;return((l=s.value)==null?void 0:l.amount)??0}),ae=b(()=>Object.entries(m.value).map(([l,{title:e}])=>({id:l,title:e}))),J=b(()=>{var l;return h((l=s.value)==null?void 0:l.localCurrencyCode)?` ${s.value.localCurrencyCode}`:"本幣"}),R=b(()=>{var l;return h((l=s.value)==null?void 0:l.foreignCurrencyCode)?` ${s.value.foreignCurrencyCode}`:"外幣"});ge(()=>{m.value=U.get("averageExchangeRate")??{},H()});function H(){Object.keys(m.value).length===0&&z(),U.set("averageExchangeRate",m.value);const l=Object.keys(m.value)[0];ie(l)&&(p.value=l)}Y(g,()=>{v.value=W()});function W(){return{sell:0,buy:0,date:P(new Date,"yyyy-MM-dd'T'HH:mm")}}const v=$(W()),f=$(null);function te(){const{buy:l,sell:e}=v.value,u=new Date(v.value.date).toISOString(),V=G();w("list",[{buy:l,sell:e,date:u,id:V},...A.value]),g.value=!1}function z(){const l=G();m.value[l]=le(),p.value=l,U.set("averageExchangeRate",m.value)}function w(l,e){if(p.value===null)return;const u=m.value[p.value]??le();u[l]=e,U.set("averageExchangeRate",m.value)}Y(_,()=>{s.value!==null&&(f.value={title:s.value.title,localCurrencyCode:s.value.localCurrencyCode??"",foreignCurrencyCode:s.value.foreignCurrencyCode??"",locale:s.value.locale??""})});function oe(){if(f.value===null)return;const{title:l,localCurrencyCode:e,foreignCurrencyCode:u,locale:V}=f.value;w("title",l),w("localCurrencyCode",h(e)?e:null),w("foreignCurrencyCode",h(u)?u:null),w("locale",h(V)?V:null),_.value=!1}const x=$(null);function ne({id:l}){x.value={message:"確定要刪除這筆資料嗎？",event:()=>{w("list",[...A.value].filter(e=>e.id!==l)),x.value=null}}}function ue(l){l!==null&&(x.value={message:"確定要刪除這張表嗎？",event:()=>{delete m.value[l],H(),x.value=null,_.value=!1}})}return(l,e)=>{const u=E("v-tab"),V=E("v-tabs"),c=E("v-text-field"),T=E("v-data-table"),k=E("v-btn"),I=E("v-card"),N=E("v-dialog");return D(),O(K,null,[y("main",xe,[n(V,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),"align-tabs":"center",color:"deep-purple-accent-4"},{default:d(()=>[(D(!0),O(K,null,pe(ae.value,({id:t,title:S},re)=>(D(),Q(u,{key:re,value:t},{default:d(()=>[X(Z(S)+" ",1),t===p.value?(D(),O("p",{key:0,class:"w-24px h-24px flex-center",onClick:e[0]||(e[0]=_e=>_.value=!0)},e[16]||(e[16]=[y("i",{class:"fa-solid fa-pen ml-4px"},null,-1)]))):ee("",!0)]),_:2},1032,["value"]))),128)),n(u,{onClick:z},{default:d(()=>e[17]||(e[17]=[y("i",{class:"fas fa-plus text-16px"},null,-1)])),_:1})]),_:1},8,["modelValue"]),y("div",Ve,[y("div",ke,[n(c,{"model-value":F.value,label:`剩餘${R.value}`,"validate-on":"invalid-input",rules:[q(ce)],type:"number","hide-details":"auto","onUpdate:modelValue":e[2]||(e[2]=t=>{const S=parseInt(t);w("amount",isNaN(S)?0:S)})},null,8,["model-value","label","rules"])]),y("div",he,[n(c,{"model-value":C.value,"hide-details":"auto",label:"平均匯率",disabled:""},null,8,["model-value"])])]),n(T,{headers:o.value,items:r.value},{"item.actions":d(({item:t})=>[y("i",{class:"fa-solid fa-trash",onClick:S=>ne(t)},null,8,we)]),_:1},8,["headers","items"]),y("div",{class:"fixed bottom-24px right-24px",onClick:e[3]||(e[3]=t=>g.value=!0)},[n(k,{icon:""},{default:d(()=>e[18]||(e[18]=[y("i",{class:"fas fa-plus"},null,-1)])),_:1})])]),n(N,{modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=t=>g.value=t)},{default:d(()=>[n(I,{"prepend-icon":"mdi-update",title:"Add Item"},{text:d(()=>[n(c,{modelValue:v.value.date,"onUpdate:modelValue":e[4]||(e[4]=t=>v.value.date=t),type:"datetime-local","hide-details":"auto",label:"交易日期"},null,8,["modelValue"]),n(c,{modelValue:v.value.sell,"onUpdate:modelValue":e[5]||(e[5]=t=>v.value.sell=t),modelModifiers:{number:!0},type:"number","hide-details":"auto",label:`賣出${J.value}`},null,8,["modelValue","label"]),n(c,{modelValue:v.value.buy,"onUpdate:modelValue":e[6]||(e[6]=t=>v.value.buy=t),modelModifiers:{number:!0},type:"number","hide-details":"auto",label:`買入${R.value}`},null,8,["modelValue","label"]),n(c,{"hide-details":"auto",label:"平均匯率","model-value":v.value.buy===0?0:q(M)(v.value.sell/v.value.buy,4),disabled:""},null,8,["model-value"])]),actions:d(()=>[n(k,{class:"ms-auto",text:"Submit",onClick:te})]),_:1})]),_:1},8,["modelValue"]),n(N,{modelValue:_.value,"onUpdate:modelValue":e[13]||(e[13]=t=>_.value=t)},{default:d(()=>[f.value!==null?(D(),Q(I,{key:0,"prepend-icon":"mdi-update",title:"Setting"},{text:d(()=>[y("div",$e,[n(c,{modelValue:f.value.title,"onUpdate:modelValue":e[8]||(e[8]=t=>f.value.title=t),"hide-details":"auto",label:"標籤名稱"},null,8,["modelValue"]),n(c,{modelValue:f.value.locale,"onUpdate:modelValue":e[9]||(e[9]=t=>f.value.locale=t),"hide-details":"auto",label:"語系代碼",placeholder:"zh-TW"},null,8,["modelValue"]),n(c,{modelValue:f.value.localCurrencyCode,"onUpdate:modelValue":e[10]||(e[10]=t=>f.value.localCurrencyCode=t),"hide-details":"auto",label:"本幣代碼",placeholder:"TWD"},null,8,["modelValue"]),n(c,{modelValue:f.value.foreignCurrencyCode,"onUpdate:modelValue":e[11]||(e[11]=t=>f.value.foreignCurrencyCode=t),"hide-details":"auto",label:"外幣代碼",placeholder:"JPY"},null,8,["modelValue"])])]),actions:d(()=>[y("div",Ee,[n(k,{text:"Delete",onClick:e[12]||(e[12]=t=>ue(p.value))}),n(k,{text:"Save",onClick:oe})])]),_:1})):ee("",!0)]),_:1},8,["modelValue"]),n(N,{"model-value":!!x.value,"onUpdate:modelValue":e[15]||(e[15]=t=>x.value=null)},{default:d(()=>[n(I,{class:"mx-auto","max-width":"320",title:"Update Field"},{text:d(()=>{var t;return[X(Z(((t=x.value)==null?void 0:t.message)??""),1)]}),actions:d(()=>{var t;return[n(k,{class:"ms-auto",text:"Cancel",onClick:e[14]||(e[14]=S=>x.value=null)}),n(k,{class:"ms-auto",text:"Delete",onClick:(t=x.value)==null?void 0:t.event},null,8,["onClick"])]}),_:1})]),_:1},8,["model-value"])],64)}}});export{Ue as default};
